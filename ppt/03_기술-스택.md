# 3. ê¸°ìˆ  ìŠ¤íƒ

## ì „ì²´ ê¸°ìˆ  ìŠ¤íƒ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND                               â”‚
â”‚    Next.js 16 + React 19 + Tailwind CSS 4 + TanStack Query     â”‚
â”‚                       Socket.IO Client                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BACKEND                                â”‚
â”‚      Next.js API Routes + NextAuth.js + Prisma ORM + Zod      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚                     â”‚  Signaling Server   â”‚
â”‚   (Database)    â”‚                     â”‚   Express + Socket  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚       Redis         â”‚
                                        â”‚   (Pub/Sub Cache)   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Frontend ê¸°ìˆ  ìŠ¤íƒ

### í•µì‹¬ í”„ë ˆì„ì›Œí¬

| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **Next.js** | 16 | React ê¸°ë°˜ í’€ìŠ¤íƒ í”„ë ˆì„ì›Œí¬ |
| **React** | 19 | UI ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **JavaScript** | ES6+ | í”„ë¡œê·¸ë˜ë° ì–¸ì–´ |

### Next.js 16 ì£¼ìš” ê¸°ëŠ¥ í™œìš©

```javascript
// App Router - íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ…
app/
â”œâ”€â”€ (auth)/           // ê·¸ë£¹ ë¼ìš°íŒ… (URLì— ë¯¸í¬í•¨)
â”‚   â”œâ”€â”€ sign-in/
â”‚   â””â”€â”€ sign-up/
â”œâ”€â”€ dashboard/        // /dashboard
â”œâ”€â”€ studies/          // /studies
â”œâ”€â”€ my-studies/
â”‚   â””â”€â”€ [studyId]/    // ë™ì  ë¼ìš°íŒ… /my-studies/abc123
â””â”€â”€ api/              // API Routes
```

- **App Router**: íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ…, ì¤‘ì²© ë ˆì´ì•„ì›ƒ
- **Server Components**: ì„œë²„ì—ì„œ ë Œë”ë§ë˜ëŠ” ì»´í¬ë„ŒíŠ¸
- **Client Components**: í´ë¼ì´ì–¸íŠ¸ ìƒí˜¸ì‘ìš© ì»´í¬ë„ŒíŠ¸ (`'use client'`)
- **Dynamic Routes**: `[studyId]` ë“± ë™ì  ê²½ë¡œ ì§€ì›
- **Route Groups**: `(auth)` ë“± URLì— í¬í•¨ë˜ì§€ ì•ŠëŠ” í´ë” ê·¸ë£¹

### React 19 ìµœì í™”

```javascript
// React Compiler (babel-plugin-react-compiler)
// ìë™ ë©”ëª¨ì´ì œì´ì…˜ - useMemo, useCallback ë¶ˆí•„ìš”
const statsCards = [
  { icon: 'ğŸ“š', label: 'í™œì„± ìŠ¤í„°ë””', value: stats.activeStudies },
  // React 19 Compilerê°€ ìë™ìœ¼ë¡œ ìµœì í™”
]
```

- **React Compiler**: ìë™ ë©”ëª¨ì´ì œì´ì…˜
- **Concurrent Features**: ë¹„ë™ê¸° ë Œë”ë§ ìµœì í™”
- **Server Actions**: ì„œë²„ í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ (ê³„íš)

### ìŠ¤íƒ€ì¼ë§

| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **Tailwind CSS** | 4 | ìœ í‹¸ë¦¬í‹° ê¸°ë°˜ CSS í”„ë ˆì„ì›Œí¬ |
| **CSS Modules** | - | ì»´í¬ë„ŒíŠ¸ ìŠ¤ì½”í”„ ìŠ¤íƒ€ì¼ë§ |

```css
/* CSS Modules ì˜ˆì‹œ - page.module.css */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.statsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}
```

### ìƒíƒœ ê´€ë¦¬

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| **TanStack Query** | 5 | ì„œë²„ ìƒíƒœ ê´€ë¦¬, ìºì‹±, ë™ê¸°í™” |
| **React Hooks** | - | ë¡œì»¬ ìƒíƒœ ê´€ë¦¬ |
| **Context API** | - | ì „ì—­ ìƒíƒœ (í…Œë§ˆ, ì¸ì¦) |

```javascript
// TanStack Query ì‚¬ìš© ì˜ˆì‹œ
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'

// ë°ì´í„° ì¡°íšŒ - ìºì‹±, ë°±ê·¸ë¼ìš´ë“œ ë¦¬íŒ¨ì¹˜ ìë™ ì²˜ë¦¬
const { data, isLoading, error } = useQuery({
  queryKey: ['study', studyId],
  queryFn: () => api.get(`/api/studies/${studyId}`)
})

// ë°ì´í„° ë³€ê²½ - ìë™ ìºì‹œ ë¬´íš¨í™”
const mutation = useMutation({
  mutationFn: (data) => api.post('/api/studies', data),
  onSuccess: () => queryClient.invalidateQueries(['studies'])
})
```

### ì‹¤ì‹œê°„ í†µì‹ 

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| **Socket.IO Client** | 4 | ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹  |
| **WebRTC** | - | P2P í™”ìƒ í†µí™” |

```javascript
// Socket.IO ì—°ê²° ì˜ˆì‹œ
const socket = io(SOCKET_URL, {
  auth: { token: session?.accessToken }
})

socket.on('connect', () => console.log('Connected'))
socket.emit('study:join', { studyId })
socket.on('chat:message', (message) => { /* ì²˜ë¦¬ */ })
```

### ì°¨íŠ¸ & ì‹œê°í™”

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| **Recharts** | 3 | í•™ìŠµ í†µê³„ ì°¨íŠ¸ |

### ë§ˆí¬ë‹¤ìš´ ì§€ì›

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| **React Markdown** | 10 | ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ |
| **Remark GFM** | 4 | GitHub Flavored Markdown |

---

## Backend ê¸°ìˆ  ìŠ¤íƒ

### API ì„œë²„

| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **Next.js API Routes** | 16 | RESTful API ì—”ë“œí¬ì¸íŠ¸ |
| **Zod** | 4 | ëŸ°íƒ€ì„ ë°ì´í„° ê²€ì¦ |
| **Winston** | 3 | êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ |

```javascript
// API Route ì˜ˆì‹œ (app/api/studies/route.js)
import { NextResponse } from 'next/server'
import { prisma } from '@/lib/prisma'
import { requireAuth } from '@/lib/auth-helpers'

export async function GET(request) {
  const session = await requireAuth()
  if (session instanceof NextResponse) return session
  
  const studies = await prisma.study.findMany({
    where: { isPublic: true },
    include: { _count: { select: { members: true } } }
  })
  
  return NextResponse.json({ success: true, data: studies })
}
```

### ì¸ì¦/ì¸ê°€

| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **NextAuth.js** | 4 | ì¸ì¦ í”„ë ˆì„ì›Œí¬ |
| **bcryptjs** | 3 | ë¹„ë°€ë²ˆí˜¸ í•´ì‹± |
| **jsonwebtoken** | 9 | JWT í† í° ìƒì„±/ê²€ì¦ |

```javascript
// NextAuth ì„¤ì • (lib/auth.js)
export const authOptions = {
  providers: [
    CredentialsProvider({
      async authorize(credentials) {
        const user = await prisma.user.findUnique({
          where: { email: credentials.email }
        })
        if (user && await bcrypt.compare(credentials.password, user.password)) {
          return user
        }
        return null
      }
    }),
    GoogleProvider({ clientId, clientSecret }),
    GitHubProvider({ clientId, clientSecret })
  ],
  session: { strategy: 'jwt' },
  callbacks: { /* jwt, session ì½œë°± */ }
}
```

### ORM & ë°ì´í„°ë² ì´ìŠ¤

| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **Prisma** | 6 | íƒ€ì… ì•ˆì „ ORM |
| **PostgreSQL** | 15 | ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ |

```prisma
// Prisma ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ (prisma/schema.prisma)
model Study {
  id          String   @id @default(cuid())
  ownerId     String
  name        String
  emoji       String   @default("ğŸ“š")
  description String   @db.Text
  category    String
  maxMembers  Int      @default(20)
  isPublic    Boolean  @default(true)
  
  owner       User          @relation("StudyOwner", fields: [ownerId], references: [id])
  members     StudyMember[]
  messages    Message[]
  
  @@index([category])
  @@index([isPublic])
}
```

### ë°ì´í„° ê²€ì¦

```javascript
// Zod ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ
import { z } from 'zod'

const CreateStudySchema = z.object({
  name: z.string().min(2).max(50),
  description: z.string().min(10).max(500),
  category: z.enum(['í”„ë¡œê·¸ë˜ë°', 'ì–´í•™', 'ìê²©ì¦', 'ì·¨ë¯¸', 'ë…ì„œ', 'ì¬í…Œí¬']),
  maxMembers: z.number().int().min(2).max(100).default(20),
  isPublic: z.boolean().default(true)
})

// APIì—ì„œ ê²€ì¦
const result = CreateStudySchema.safeParse(body)
if (!result.success) {
  return NextResponse.json({ error: result.error.issues }, { status: 400 })
}
```

---

## Signaling Server (ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤)

### í•µì‹¬ ê¸°ìˆ 

| ê¸°ìˆ  | ë²„ì „ | ì„¤ëª… |
|------|------|------|
| **Node.js** | 18+ | JavaScript ëŸ°íƒ€ì„ |
| **Express.js** | 4 | ì›¹ í”„ë ˆì„ì›Œí¬ |
| **Socket.IO** | 4 | WebSocket í†µì‹  |
| **Redis Adapter** | 8 | ë‹¤ì¤‘ ì„œë²„ ì§€ì› |

```javascript
// ì‹œê·¸ë„ë§ ì„œë²„ (signaling-server/server.js)
import express from 'express'
import { Server } from 'socket.io'
import { createAdapter } from '@socket.io/redis-adapter'

const io = new Server(httpServer, {
  cors: { origin: ALLOWED_ORIGINS }
})

// Redis Adapterë¡œ ë‹¤ì¤‘ ì„œë²„ ì§€ì›
io.adapter(createAdapter(redisClient, redisSubClient))

// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
io.on('connection', (socket) => {
  handleVideoEvents(socket, io)   // í™”ìƒ í†µí™”
  handleChatEvents(socket, io)    // ì±„íŒ…
  handlePresenceEvents(socket, io) // ì˜¨ë¼ì¸ ìƒíƒœ
})
```

### WebRTC ì‹œê·¸ë„ë§ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User A â”‚              â”‚ Signaling Serverâ”‚              â”‚  User B â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                            â”‚                            â”‚
     â”‚â”€â”€â”€â”€ video:join-room â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
     â”‚<â”€â”€â”€â”€ video:room-state â”€â”€â”€â”€â”€â”‚                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚<â”€â”€â”€â”€ video:join-room â”€â”€â”€â”€â”€â”€â”‚
     â”‚<â”€â”€â”€â”€ video:user-joined â”€â”€â”€â”€â”‚                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚â”€â”€â”€â”€ video:offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€ video:offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                            â”‚                            â”‚
     â”‚<â”€â”€â”€â”€ video:answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€ video:answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                            â”‚                            â”‚
     â”‚<â”€â”€â”€â”€â”€ ICE Candidates â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€ ICE Candidates â”€â”€â”€â”€â”€â”€â”‚
     â”‚                            â”‚                            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ P2P Connection Established â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
```

---

## Infrastructure

### ë°ì´í„°ë² ì´ìŠ¤

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| **PostgreSQL** | 15 | ì£¼ ë°ì´í„°ë² ì´ìŠ¤ |
| **Redis** | 7 | ìºì‹œ, Pub/Sub, ì„¸ì…˜ |

### ì»¨í…Œì´ë„ˆí™”

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| **Docker** | Latest | ì»¨í…Œì´ë„ˆí™” |
| **Docker Compose** | 3.8 | ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |

```yaml
# docker-compose.yml
services:
  nextjs:
    build: ./coup
    ports: ["3000:3000"]
    depends_on: [postgres, redis]
    
  signaling:
    build: ./signaling-server
    ports: ["4000:4000"]
    depends_on: [redis]
    
  postgres:
    image: postgres:14-alpine
    volumes: [postgres_data:/var/lib/postgresql/data]
    
  redis:
    image: redis:7-alpine
    volumes: [redis_data:/data]
```

---

## ê°œë°œ ë„êµ¬

| ë„êµ¬ | ìš©ë„ |
|------|------|
| **Visual Studio Code** | IDE |
| **Git & GitHub** | ë²„ì „ ê´€ë¦¬ |
| **npm** | íŒ¨í‚¤ì§€ ê´€ë¦¬ |
| **ESLint** | ì½”ë“œ ë¦°íŒ… |
| **Jest** | í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ |
| **Prisma Studio** | ë°ì´í„°ë² ì´ìŠ¤ GUI |

---

## ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ ìš”ì•½

### Frontend (coup/package.json)

```json
{
  "next": "16.0.1",
  "react": "19.2.0",
  "react-dom": "19.2.0",
  "@tanstack/react-query": "^5.90.10",
  "next-auth": "^4.24.13",
  "socket.io-client": "^4.8.1",
  "react-markdown": "^10.1.0",
  "recharts": "^3.5.1",
  "tailwindcss": "^4"
}
```

### Backend (coup/package.json)

```json
{
  "@prisma/client": "^6.19.0",
  "prisma": "^6.19.0",
  "bcryptjs": "^3.0.3",
  "jsonwebtoken": "^9.0.2",
  "zod": "^4.1.12",
  "winston": "^3.18.3"
}
```

### Signaling Server

```json
{
  "socket.io": "^4.6.0",
  "@socket.io/redis-adapter": "^8.3.0",
  "redis": "^4.6.0",
  "express": "^4.18.0",
  "cors": "^2.8.5"
}
```

