# í˜„ì¬ êµ¬í˜„ ìƒíƒœ

> **ì‘ì„±ì¼**: 2025-11-19  
> **ë¶„ì„ ëŒ€ìƒ**: í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ ì½”ë“œë² ì´ìŠ¤  
> **ëª©ì **: êµ¬í˜„ëœ ê¸°ëŠ¥ê³¼ ë¯¸êµ¬í˜„ ê¸°ëŠ¥ íŒŒì•…

---

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ ìš”ì•½](#1-ì „ì²´-ìš”ì•½)
2. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ìƒíƒœ](#2-í”„ë¡ íŠ¸ì—”ë“œ-êµ¬í˜„-ìƒíƒœ)
3. [ë°±ì—”ë“œ êµ¬í˜„ ìƒíƒœ](#3-ë°±ì—”ë“œ-êµ¬í˜„-ìƒíƒœ)
4. [í…ŒìŠ¤íŠ¸ ìƒíƒœ](#4-í…ŒìŠ¤íŠ¸-ìƒíƒœ)
5. [ì´ìŠˆ ë° ë²„ê·¸](#5-ì´ìŠˆ-ë°-ë²„ê·¸)

---

## 1. ì „ì²´ ìš”ì•½

### 1.1 êµ¬í˜„ ì™„ë£Œ âœ…

| í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|-----|------|------|
| UI ë ˆì´ì•„ì›ƒ | âœ… | ëŒ€ê¸°ì‹¤ + ì „ì²´í™”ë©´ ëª¨ë“œ ì™„ë£Œ |
| ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° | âœ… | VideoTile, ControlBar ë¶„ë¦¬ |
| ì†Œì¼“ ì—°ê²° | âœ… | Socket.io í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ì„¤ì • |
| ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ | âœ… | Socket.io ì—°ê²° ì‹œ ì‚¬ìš©ì ì¸ì¦ |
| ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ | âœ… | ì¹´ë©”ë¼/ë§ˆì´í¬ íšë“ |
| ìŒì†Œê±°/ë¹„ë””ì˜¤ í† ê¸€ | âœ… | í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì œì–´ |
| í™”ë©´ ê³µìœ  | âœ… | ê¸°ë³¸ êµ¬ì¡° êµ¬í˜„ |

### 1.2 ë¶€ë¶„ êµ¬í˜„ âš ï¸

| í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|-----|------|------|
| WebRTC ì—°ê²° | âš ï¸ | êµ¬ì¡°ëŠ” ìˆìœ¼ë‚˜ ì‹¤ì œ P2P ì—°ê²° ë¯¸ê²€ì¦ |
| ì‹œê·¸ë„ë§ | âš ï¸ | ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„ë˜ì—ˆìœ¼ë‚˜ í…ŒìŠ¤íŠ¸ í•„ìš” |
| ì°¸ì—¬ì ê´€ë¦¬ | âš ï¸ | ëª©ë¡ í‘œì‹œë§Œ ë¨, ì œì–´ ê¸°ëŠ¥ ë¯¸êµ¬í˜„ |
| ì—ëŸ¬ ì²˜ë¦¬ | âš ï¸ | ê¸°ë³¸ì ì¸ ì—ëŸ¬ë§Œ ì²˜ë¦¬ |

### 1.3 ë¯¸êµ¬í˜„ âŒ

| í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|-----|------|------|
| ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ | âŒ | ì„¸ì…˜ ê¸°ë¡ ì €ì¥ êµ¬ì¡° ì—†ìŒ |
| REST API | âŒ | í™”ìƒíšŒì˜ ê´€ë ¨ API ì—†ìŒ |
| ì°¸ì—¬ì ì œì–´ (í˜¸ìŠ¤íŠ¸) | âŒ | ìŒì†Œê±°/ê°•í‡´ ê¸°ëŠ¥ ì—†ìŒ |
| ì±„íŒ… í†µí•© | âŒ | í™”ìƒíšŒì˜ ì¤‘ ì±„íŒ… ë¯¸ì—°ë™ |
| í†µí™” í’ˆì§ˆ ëª¨ë‹ˆí„°ë§ | âŒ | ë„¤íŠ¸ì›Œí¬ í†µê³„ ìˆ˜ì§‘ ì—†ìŒ |
| ìš°ì¸¡ ìœ„ì ¯ | âŒ | íŠ¹í™” ìœ„ì ¯ ë¯¸êµ¬í˜„ |
| ë ˆì´ì•„ì›ƒ ëª¨ë“œ ì „í™˜ | âŒ | ê·¸ë¦¬ë“œ/ë°œí‘œì ëª¨ë“œ ìë™ ì „í™˜ ì—†ìŒ |
| ë§í•˜ëŠ” ì¤‘ í‘œì‹œ | âŒ | ìŒì„± ê°ì§€ ì—†ìŒ |
| ìë™ ì¬ì—°ê²° | âŒ | ì—°ê²° ëŠê¹€ ì‹œ ë³µêµ¬ ë¡œì§ ì—†ìŒ |

---

## 2. í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ìƒíƒœ

### 2.1 í˜ì´ì§€ êµ¬ì¡°

#### íŒŒì¼: `/coup/src/app/my-studies/[studyId]/video-call/page.jsx`

**âœ… êµ¬í˜„ëœ ê¸°ëŠ¥**:
- ëŒ€ê¸°ì‹¤ í™”ë©´ (ì°¸ì—¬ ì „)
- ì „ì²´ í™”ë©´ ëª¨ë“œ (ì°¸ì—¬ í›„)
- ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ
- ì»¨íŠ¸ë¡¤ ë°”
- í†µí™” ì‹œê°„ ì¹´ìš´í„°

**âŒ ë¯¸êµ¬í˜„ ê¸°ëŠ¥**:
- ìš°ì¸¡ ì‚¬ì´ë“œë°” ìœ„ì ¯ (í†µí™” ì¤‘)
- ì±„íŒ… íŒ¨ë„
- ì°¸ì—¬ì ì œì–´ íŒ¨ë„
- ì„¤ì • ëª¨ë‹¬
- ë„¤íŠ¸ì›Œí¬ í’ˆì§ˆ í‘œì‹œ

**ì½”ë“œ ë¶„ì„**:

```javascript
// ëŒ€ê¸°ì‹¤ ìƒíƒœ ê´€ë¦¬
const [isInCall, setIsInCall] = useState(false);

// âœ… êµ¬í˜„ë¨: ì°¸ì—¬í•˜ê¸°
const handleJoinCall = async () => {
  try {
    await joinRoom(true, true);
    setIsInCall(true);
  } catch (err) {
    alert(error || 'í™”ìƒíšŒì˜ ì…ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
};

// âœ… êµ¬í˜„ë¨: ë‚˜ê°€ê¸°
const handleLeaveCall = () => {
  if (confirm('ì •ë§ í†µí™”ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    leaveRoom();
    setIsInCall(false);
    router.push(`/my-studies/${studyId}`);
  }
};

// âœ… êµ¬í˜„ë¨: í™”ë©´ ê³µìœ 
const handleShareScreen = () => {
  if (isSharingScreen) {
    stopScreenShare();
  } else {
    shareScreen().catch(() => {
      alert('í™”ë©´ ê³µìœ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });
  }
};
```

**ê°œì„  í•„ìš” ì‚¬í•­**:
1. ì—ëŸ¬ ì²˜ë¦¬ë¥¼ alert ëŒ€ì‹  Toast ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
2. ë¡œë”© ìƒíƒœ ì¶”ê°€
3. ë””ë°”ì´ìŠ¤ ì„ íƒ UI ì¶”ê°€
4. ì°¸ì—¬ì ì •ë³´ í‘œì‹œ ê°•í™”

### 2.2 useVideoCall í›…

#### íŒŒì¼: `/coup/src/lib/hooks/useVideoCall.js`

**âœ… êµ¬í˜„ëœ ê¸°ëŠ¥**:

```javascript
// ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ ì´ˆê¸°í™”
const initLocalStream = useCallback(async (videoEnabled, audioEnabled) => {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: videoEnabled ? { width: 1280, height: 720 } : false,
    audio: audioEnabled ? { echoCancellation: true } : false
  });
  // âœ… ì„¤ì • ì ì ˆí•¨
});

// Peer Connection ìƒì„±
const createPeerConnection = useCallback((socketId, isInitiator) => {
  const peer = new RTCPeerConnection(iceServersRef.current);
  
  // âœ… ë¡œì»¬ íŠ¸ë™ ì¶”ê°€
  localStreamRef.current.getTracks().forEach(track => {
    peer.addTrack(track, localStreamRef.current);
  });
  
  // âœ… ì›ê²© ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ 
  peer.ontrack = (event) => {
    const [remoteStream] = event.streams;
    setRemoteStreams(prev => {
      const newMap = new Map(prev);
      newMap.set(socketId, remoteStream);
      return newMap;
    });
  };
  
  // âœ… ICE Candidate ì „ì†¡
  peer.onicecandidate = (event) => {
    if (event.candidate && socket) {
      socket.emit('video:ice-candidate', {
        to: socketId,
        candidate: event.candidate
      });
    }
  };
  
  // âš ï¸ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§ (ë¡œê¹…ë§Œ í•¨)
  peer.onconnectionstatechange = () => {
    console.log(`Peer connection state (${socketId}):`, peer.connectionState);
    if (peer.connectionState === 'failed' || peer.connectionState === 'disconnected') {
      cleanupPeer(socketId);
    }
  };
});

// âœ… ë°© ì…ì¥
const joinRoom = useCallback(async (videoEnabled, audioEnabled) => {
  await initLocalStream(videoEnabled, audioEnabled);
  socket.emit('video:join-room', { studyId, roomId });
});

// âœ… ë°© ë‚˜ê°€ê¸°
const leaveRoom = useCallback(() => {
  // ìŠ¤íŠ¸ë¦¼ ì •ë¦¬
  if (localStreamRef.current) {
    localStreamRef.current.getTracks().forEach(track => track.stop());
  }
  
  // Peer Connection ì •ë¦¬
  peersRef.current.forEach((peer, socketId) => {
    peer.close();
  });
  
  socket.emit('video:leave-room', { roomId });
});

// âœ… ìŒì†Œê±° í† ê¸€
const toggleMute = useCallback(() => {
  const audioTrack = localStreamRef.current.getAudioTracks()[0];
  if (audioTrack) {
    audioTrack.enabled = !audioTrack.enabled;
    const newMutedState = !audioTrack.enabled;
    setIsMuted(newMutedState);
    socket.emit('video:toggle-audio', { roomId, isMuted: newMutedState });
  }
});

// âœ… ë¹„ë””ì˜¤ í† ê¸€
const toggleVideo = useCallback(() => {
  const videoTrack = localStreamRef.current.getVideoTracks()[0];
  if (videoTrack) {
    videoTrack.enabled = !videoTrack.enabled;
    const newVideoOffState = !videoTrack.enabled;
    setIsVideoOff(newVideoOffState);
    socket.emit('video:toggle-video', { roomId, isVideoOff: newVideoOffState });
  }
});

// âœ… í™”ë©´ ê³µìœ 
const shareScreen = useCallback(async () => {
  const screenStream = await navigator.mediaDevices.getDisplayMedia({
    video: { cursor: 'always' }
  });
  
  const screenTrack = screenStream.getVideoTracks()[0];
  
  // ëª¨ë“  Peerì˜ ë¹„ë””ì˜¤ íŠ¸ë™ êµì²´
  peersRef.current.forEach(peer => {
    const sender = peer.getSenders().find(s => s.track?.kind === 'video');
    if (sender) {
      sender.replaceTrack(screenTrack);
    }
  });
  
  socket.emit('video:screen-share-start', { roomId });
  
  // ì¢…ë£Œ ì‹œ ë³µêµ¬
  screenTrack.onended = () => {
    stopScreenShare();
  };
});
```

**âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­**:

1. **ì—ëŸ¬ ë³µêµ¬ ë¡œì§ ì—†ìŒ**
   ```javascript
   // í˜„ì¬: ê·¸ëƒ¥ ì •ë¦¬ë§Œ í•¨
   if (peer.connectionState === 'failed') {
     cleanupPeer(socketId);
   }
   
   // í•„ìš”: ì¬ì—°ê²° ì‹œë„
   if (peer.connectionState === 'failed') {
     await retryConnection(socketId, 3); // 3íšŒ ì¬ì‹œë„
   }
   ```

2. **ë„¤íŠ¸ì›Œí¬ í†µê³„ ìˆ˜ì§‘ ì—†ìŒ**
   ```javascript
   // ì¶”ê°€ í•„ìš”
   const getConnectionStats = async (peer) => {
     const stats = await peer.getStats();
     // latency, bandwidth, packet loss ë“± ìˆ˜ì§‘
   };
   ```

3. **ìŒì„± ê°ì§€ ì—†ìŒ**
   ```javascript
   // ì¶”ê°€ í•„ìš”
   const detectSpeaking = (stream) => {
     const audioContext = new AudioContext();
     const analyser = audioContext.createAnalyser();
     // ìŒëŸ‰ ë ˆë²¨ ê°ì§€í•˜ì—¬ speaking ìƒíƒœ ì—…ë°ì´íŠ¸
   };
   ```

**âŒ ë¯¸êµ¬í˜„ ê¸°ëŠ¥**:
- ìë™ ì¬ì—°ê²°
- ë„¤íŠ¸ì›Œí¬ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§
- ìŒì„± ê°ì§€ (ë§í•˜ëŠ” ì¤‘ í‘œì‹œ)
- ëŒ€ì—­í­ ì ì‘í˜• í’ˆì§ˆ ì¡°ì •
- ê°€ìƒ ë°°ê²½

### 2.3 VideoTile ì»´í¬ë„ŒíŠ¸

#### íŒŒì¼: `/coup/src/components/video-call/VideoTile.jsx`

**âœ… êµ¬í˜„ëœ ê¸°ëŠ¥**:
- ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ë Œë”ë§
- ë¹„ë””ì˜¤ êº¼ì§ ì‹œ í”„ë¡œí•„ í‘œì‹œ
- ìŒì†Œê±°/ë¹„ë””ì˜¤ ì˜¤í”„ ì•„ì´ì½˜
- ë¡œì»¬/ì›ê²© êµ¬ë¶„ í‘œì‹œ

```javascript
// âœ… ë¹„ë””ì˜¤ ë Œë”ë§
<video
  ref={videoRef}
  autoPlay
  playsInline
  muted={isLocal}  // ë¡œì»¬ì€ ìŒì†Œê±° (ì—ì½” ë°©ì§€)
  className={styles.video}
/>

// âœ… ë¹„ë””ì˜¤ ì˜¤í”„ ì‹œ ì•„ë°”íƒ€
{isVideoOff || !stream ? (
  <div className={styles.avatarContainer}>
    <div className={styles.avatar}>
      {user?.name?.charAt(0)?.toUpperCase() || '?'}
    </div>
  </div>
) : (
  // ë¹„ë””ì˜¤
)}

// âœ… ìƒíƒœ í‘œì‹œ
<div className={styles.overlay}>
  <div className={styles.name}>
    {user?.name || 'Unknown'}
    {isLocal && ' (ë‚˜)'}
  </div>
  <div className={styles.indicators}>
    {isMuted && <span>ğŸ”‡</span>}
    {isVideoOff && <span>ğŸ“¹âŒ</span>}
  </div>
</div>
```

**âš ï¸ ë¶€ë¶„ êµ¬í˜„**:
- `isSpeaking` propì€ ë°›ì§€ë§Œ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
  ```javascript
  // ìˆìŒ
  const VideoTile = ({ isSpeaking, ... }) => { ... }
  
  // ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (ë¶€ëª¨ì—ì„œ ì „ë‹¬ ì•ˆ ë¨)
  className={`${styles.videoTile} ${isSpeaking ? styles.speaking : ''}`}
  ```

**âŒ ë¯¸êµ¬í˜„ ê¸°ëŠ¥**:
- ë„¤íŠ¸ì›Œí¬ ê²½ê³  í‘œì‹œ
- í†µê³„ ì˜¤ë²„ë ˆì´ (fps, í•´ìƒë„ ë“±)
- ë”ë¸”í´ë¦­ìœ¼ë¡œ ì „ì²´í™”ë©´
- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ (ìš°í´ë¦­)

### 2.4 ControlBar ì»´í¬ë„ŒíŠ¸

#### íŒŒì¼: `/coup/src/components/video-call/ControlBar.jsx`

**âœ… êµ¬í˜„ëœ ê¸°ëŠ¥**:
- ìŒì†Œê±°/ë¹„ë””ì˜¤ í† ê¸€ ë²„íŠ¼
- í™”ë©´ ê³µìœ  ë²„íŠ¼
- ì„¤ì • ë²„íŠ¼ (ê¸°ëŠ¥ ì—†ìŒ)
- ë‚˜ê°€ê¸° ë²„íŠ¼
- í†µí™” ì‹œê°„ í‘œì‹œ

```javascript
// âœ… ë²„íŠ¼ êµ¬ì¡° ì ì ˆ
<button
  className={`${styles.controlButton} ${isMuted ? styles.active : ''}`}
  onClick={onToggleMute}
  title={isMuted ? 'ìŒì†Œê±° í•´ì œ' : 'ìŒì†Œê±°'}
>
  {isMuted ? 'ğŸ”‡' : 'ğŸ¤'}
</button>
```

**âŒ ë¯¸êµ¬í˜„ ê¸°ëŠ¥**:
- ì±„íŒ… ë²„íŠ¼
- ì°¸ì—¬ì ëª©ë¡ ë²„íŠ¼
- ë ˆì´ì•„ì›ƒ ì „í™˜ ë²„íŠ¼
- í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (M, V, S ë“±)
- ë””ë°”ì´ìŠ¤ ì„ íƒ ë“œë¡­ë‹¤ìš´

### 2.5 useSocket í›…

#### íŒŒì¼: `/coup/src/lib/hooks/useSocket.js`

**âœ… êµ¬í˜„ëœ ê¸°ëŠ¥**:
- Socket.io í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
- ì‚¬ìš©ì ì¸ì¦ (userId ì „ë‹¬)
- ì—°ê²° ìƒíƒœ ê´€ë¦¬
- Transport ì •ë³´ (WebSocket/Polling)

```javascript
// âœ… ì¸ì¦ í¬í•¨ ì—°ê²°
socket = io(process.env.NEXT_PUBLIC_SOCKET_URL || '', {
  auth: {
    userId: user.id
  },
  transports: ['websocket', 'polling']
});

// âœ… ì—°ê²° ì´ë²¤íŠ¸
socket.on('connect', () => {
  setIsConnected(true);
});

socket.on('disconnect', () => {
  setIsConnected(false);
});
```

**âš ï¸ ê°œì„  í•„ìš”**:
- ì¬ì—°ê²° ë¡œì§ ê°•í™”
- ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì „ëµ
- ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì²˜ë¦¬

---

## 3. ë°±ì—”ë“œ êµ¬í˜„ ìƒíƒœ

### 3.1 Socket.io ì„œë²„

#### íŒŒì¼: `/coup/src/lib/socket/server.js`

**âœ… êµ¬í˜„ëœ ê¸°ëŠ¥**:

```javascript
// âœ… ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
io.use(async (socket, next) => {
  const userId = socket.handshake.auth.userId;
  
  if (!userId) {
    return next(new Error('Authentication required'));
  }
  
  const user = await prisma.user.findUnique({
    where: { id: userId }
  });
  
  if (!user || user.status !== 'ACTIVE') {
    return next(new Error('User not found or inactive'));
  }
  
  socket.userId = userId;
  socket.user = user;
  next();
});

// âœ… ì˜¨ë¼ì¸ ìƒíƒœ ê´€ë¦¬
async function handleUserOnline(socket) {
  await prisma.user.update({
    where: { id: socket.userId },
    data: { lastLoginAt: new Date() }
  });
  
  // ìŠ¤í„°ë”” ë£¸ì— ì˜¨ë¼ì¸ ì•Œë¦¼
  studyMembers.forEach(({ studyId }) => {
    socket.join(`study:${studyId}`);
    socket.to(`study:${studyId}`).emit('user:online', {
      userId: socket.userId,
      user: socket.user
    });
  });
}

// âš ï¸ í™”ìƒíšŒì˜ ì´ë²¤íŠ¸ (ê¸°ë³¸ êµ¬ì¡°ë§Œ)
function handleVideoCallEvents(socket) {
  // âœ… ì‹œì‘
  socket.on('video:start', async (data) => {
    socket.join(`video:${roomId}`);
    socket.to(`study:${studyId}`).emit('video:started', {
      roomId,
      startedBy: socket.user
    });
  });
  
  // âœ… ì°¸ì—¬
  socket.on('video:join', (data) => {
    socket.join(`video:${roomId}`);
    socket.to(`video:${roomId}`).emit('video:user-joined', {
      userId: socket.userId,
      user: socket.user
    });
    
    const participants = getVideoCallParticipants(roomId);
    socket.emit('video:participants', { participants });
  });
  
  // âœ… WebRTC ì‹œê·¸ë„ë§
  socket.on('video:signal', (data) => {
    const { to, signal } = data;
    io.to(to).emit('video:signal', {
      from: socket.id,
      signal
    });
  });
  
  // âœ… ë‚˜ê°€ê¸°
  socket.on('video:leave', (data) => {
    socket.leave(`video:${roomId}`);
    socket.to(`video:${roomId}`).emit('video:user-left', {
      userId: socket.userId
    });
  });
}
```

**âŒ ë¯¸êµ¬í˜„ ê¸°ëŠ¥**:

1. **ì„¸ë¶€ ì‹œê·¸ë„ë§ ì´ë²¤íŠ¸ ë¯¸ì²˜ë¦¬**
   ```javascript
   // í•„ìš”í•˜ì§€ë§Œ ì—†ìŒ
   socket.on('video:offer', ...)
   socket.on('video:answer', ...)
   socket.on('video:ice-candidate', ...)
   socket.on('video:toggle-audio', ...)
   socket.on('video:toggle-video', ...)
   socket.on('video:screen-share-start', ...)
   socket.on('video:screen-share-stop', ...)
   ```

2. **ì°¸ì—¬ì ì œì–´ ì´ë²¤íŠ¸ ì—†ìŒ**
   ```javascript
   // í•„ìš”
   socket.on('video:mute-participant', ...)  // í˜¸ìŠ¤íŠ¸ê°€ ê°•ì œ ìŒì†Œê±°
   socket.on('video:kick-participant', ...)  // í˜¸ìŠ¤íŠ¸ê°€ ê°•í‡´
   ```

3. **í†µí™” í’ˆì§ˆ ëª¨ë‹ˆí„°ë§ ì—†ìŒ**
   ```javascript
   // í•„ìš”
   socket.on('video:stats', ...)  // ë„¤íŠ¸ì›Œí¬ í†µê³„ ìˆ˜ì§‘
   ```

### 3.2 REST API

#### ìƒíƒœ: âŒ **ì „ë¬´**

**í•„ìš”í•œ API**:

```
POST   /api/my-studies/[studyId]/video-call/start
       - í™”ìƒíšŒì˜ ì‹œì‘
       - roomId ìƒì„±
       - ì•Œë¦¼ ì „ì†¡

GET    /api/my-studies/[studyId]/video-call/status
       - í˜„ì¬ ì§„í–‰ ì¤‘ì¸ íšŒì˜ ì •ë³´
       - ì°¸ì—¬ì ëª©ë¡

POST   /api/my-studies/[studyId]/video-call/join
       - ì°¸ì—¬ ê¸°ë¡
       - ê¶Œí•œ ê²€ì¦

POST   /api/my-studies/[studyId]/video-call/leave
       - í‡´ì¥ ê¸°ë¡
       - í†µê³„ ì €ì¥

GET    /api/my-studies/[studyId]/video-call/history
       - ê³¼ê±° ì„¸ì…˜ ëª©ë¡
       - í†µê³„ ì¡°íšŒ

GET    /api/my-studies/[studyId]/video-call/sessions/[sessionId]
       - íŠ¹ì • ì„¸ì…˜ ìƒì„¸ ì •ë³´
```

### 3.3 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

#### ìƒíƒœ: âŒ **ì—†ìŒ**

**í•„ìš”í•œ ëª¨ë¸**:

```prisma
// í™”ìƒíšŒì˜ ì„¸ì…˜
model VideoCallSession {
  id          String   @id @default(cuid())
  studyId     String
  roomId      String   @unique
  startedAt   DateTime @default(now())
  endedAt     DateTime?
  duration    Int?     // ì´ˆ ë‹¨ìœ„
  
  study       Study    @relation(fields: [studyId], references: [id])
  participants VideoCallParticipant[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([studyId])
  @@index([roomId])
}

// ì°¸ì—¬ì ê¸°ë¡
model VideoCallParticipant {
  id          String   @id @default(cuid())
  sessionId   String
  userId      String
  joinedAt    DateTime @default(now())
  leftAt      DateTime?
  duration    Int?     // ì´ˆ ë‹¨ìœ„
  
  // í†µê³„
  audioMutedTime  Int? // ìŒì†Œê±° ì‹œê°„ (ì´ˆ)
  videoOffTime    Int? // ë¹„ë””ì˜¤ êº¼ì§„ ì‹œê°„ (ì´ˆ)
  screenSharedTime Int? // í™”ë©´ ê³µìœ  ì‹œê°„ (ì´ˆ)
  
  session     VideoCallSession @relation(fields: [sessionId], references: [id])
  user        User    @relation(fields: [userId], references: [id])
  
  @@unique([sessionId, userId])
  @@index([userId])
}
```

---

## 4. í…ŒìŠ¤íŠ¸ ìƒíƒœ

### 4.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

**ìƒíƒœ**: âŒ **ì—†ìŒ**

**í•„ìš”í•œ í…ŒìŠ¤íŠ¸**:
- useVideoCall í›… í…ŒìŠ¤íŠ¸
- VideoTile ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸
- ControlBar ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸
- Socket ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í…ŒìŠ¤íŠ¸

### 4.2 í†µí•© í…ŒìŠ¤íŠ¸

**ìƒíƒœ**: âŒ **ì—†ìŒ**

**í•„ìš”í•œ ì‹œë‚˜ë¦¬ì˜¤**:
- 2ëª… ì°¸ì—¬ ì‹œë‚˜ë¦¬ì˜¤
- í™”ë©´ ê³µìœ  ì‹œë‚˜ë¦¬ì˜¤
- ì°¸ì—¬ì ì…í‡´ì¥ ì‹œë‚˜ë¦¬ì˜¤
- ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ì‹œë‚˜ë¦¬ì˜¤

### 4.3 E2E í…ŒìŠ¤íŠ¸

**ìƒíƒœ**: âŒ **ì—†ìŒ**

**í•„ìš”í•œ ì‹œë‚˜ë¦¬ì˜¤**:
- ëŒ€ê¸°ì‹¤ â†’ ì°¸ì—¬ â†’ í†µí™” â†’ ë‚˜ê°€ê¸° ì „ì²´ í”Œë¡œìš°
- ë‹¤ì¤‘ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸
- ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±

---

## 5. ì´ìŠˆ ë° ë²„ê·¸

### 5.1 í™•ì¸ëœ ì´ìŠˆ

#### ğŸ› P0 (Critical)

1. **WebRTC ì‹¤ì œ ì—°ê²° ë¯¸ê²€ì¦**
   - ì½”ë“œëŠ” ìˆìœ¼ë‚˜ ì‹¤ì œë¡œ P2P ì—°ê²°ì´ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ ì•ˆ ë¨
   - Offer/Answer êµí™˜ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ ë¶ˆëª…í™•

2. **ì‹œê·¸ë„ë§ ì´ë²¤íŠ¸ ë¶ˆì¼ì¹˜**
   - í”„ë¡ íŠ¸: `video:join-room` ì‚¬ìš©
   - ë°±ì—”ë“œ: `video:join` í•¸ë“¤ëŸ¬ ìˆìŒ
   - ì´ë²¤íŠ¸ ì´ë¦„ í‘œì¤€í™” í•„ìš”

3. **Socket ì´ë²¤íŠ¸ ëˆ„ë½**
   - ë°±ì—”ë“œì— offer/answer/ice-candidate í•¸ë“¤ëŸ¬ ì—†ìŒ
   - í”„ë¡ íŠ¸ì—ì„œ emití•˜ì§€ë§Œ ì„œë²„ê°€ relay ì•ˆ í•¨

#### âš ï¸ P1 (High)

4. **ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±**
   - ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ì‹œ ì¬ì—°ê²° ë¡œì§ ì—†ìŒ
   - ê¶Œí•œ ê±°ë¶€ ì‹œ ëŒ€ì²´ ë°©ì•ˆ ì—†ìŒ

5. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìœ„í—˜**
   - í˜ì´ì§€ ì´ë™ ì‹œ ìŠ¤íŠ¸ë¦¼ ì •ë¦¬ ëˆ„ë½ ê°€ëŠ¥ì„±
   - Peer Connection ì •ë¦¬ í™•ì¸ í•„ìš”

6. **ìƒíƒœ ë™ê¸°í™” ì´ìŠˆ**
   - ìŒì†Œê±°/ë¹„ë””ì˜¤ ìƒíƒœê°€ ë‹¤ë¥¸ ì°¸ì—¬ìì—ê²Œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
   - ì„œë²„ì—ì„œ relay í•„ìš”

#### ğŸ“ P2 (Medium)

7. **UI/UX ê°œì„ **
   - ë¡œë”© ìƒíƒœ í‘œì‹œ ë¶€ì¡±
   - ì—ëŸ¬ ë©”ì‹œì§€ê°€ alertë¡œ í‘œì‹œ (Toast í•„ìš”)
   - ì°¸ì—¬ì ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ ì•ˆ ë  ìˆ˜ ìˆìŒ

8. **ì„±ëŠ¥ ìµœì í™”**
   - ë¹„ë””ì˜¤ í’ˆì§ˆ ê³ ì • (ë„¤íŠ¸ì›Œí¬ ì ì‘í˜• ì•„ë‹˜)
   - ì°¸ì—¬ì ë§ì„ ë•Œ ë ˆì´ì•„ì›ƒ ìµœì í™” í•„ìš”

### 5.2 ë³´ì•ˆ ì·¨ì•½ì 

1. **ê¶Œí•œ ê²€ì¦ ë¶€ì¡±**
   - REST APIê°€ ì—†ì–´ ëˆ„êµ¬ë‚˜ roomIdë§Œ ì•Œë©´ ì°¸ì—¬ ê°€ëŠ¥
   - ìŠ¤í„°ë”” ë©¤ë²„ ì—¬ë¶€ í™•ì¸ í•„ìš”

2. **Rate Limiting ì—†ìŒ**
   - ë¬´í•œ ì—°ê²° ì‹œë„ ê°€ëŠ¥

3. **ë°ì´í„° ê²€ì¦ ë¶€ì¡±**
   - Socket ì´ë²¤íŠ¸ ë°ì´í„° ê²€ì¦ ì—†ìŒ

---

## 6. ë‹¤ìŒ ë‹¨ê³„

### 6.1 ì¦‰ì‹œ í•´ê²° í•„ìš” (P0)

1. âœ… Socket ì´ë²¤íŠ¸ í†µì¼ ë° í•¸ë“¤ëŸ¬ ì¶”ê°€
2. âœ… WebRTC ì—°ê²° í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…
3. âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¶”ê°€

### 6.2 ë‹¨ê¸° (1-2ì£¼)

4. âœ… REST API êµ¬í˜„
5. âœ… ì°¸ì—¬ì ì œì–´ ê¸°ëŠ¥ (í˜¸ìŠ¤íŠ¸)
6. âœ… ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
7. âœ… í†µí™” í’ˆì§ˆ ëª¨ë‹ˆí„°ë§

### 6.3 ì¤‘ê¸° (1ê°œì›”)

8. âœ… ì±„íŒ… í†µí•©
9. âœ… ìš°ì¸¡ ìœ„ì ¯ êµ¬í˜„
10. âœ… í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
11. âœ… ì„±ëŠ¥ ìµœì í™”

---

**ë‹¤ìŒ ë¬¸ì„œ**: [êµ¬í˜„ ê³„íš](./03-implementation-plan.md)

