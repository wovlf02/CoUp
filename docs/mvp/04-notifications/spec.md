# MVP 기능 명세: 04. 알림

## 1. 개요

- 사용자는 서비스 내에서 발생하는 중요한 이벤트(예: 새 메시지, 가입 승인)에 대해 실시간으로 알림을 받아야 한다.
- MVP 단계에서는 서비스 내에서 확인할 수 있는 기본적인 알림 목록 기능을 제공한다.
- 실시간 알림 푸시는 시그널링 서버를 통해 전달된다.

## 2. 사용자 스토리 (User Stories)

### 2.1. 알림 생성

- **US-1.1**: 다음과 같은 이벤트가 발생했을 때, 관련 사용자에게 알림이 생성되어야 한다.
  - **스터디 가입**: 내 스터디 가입 신청이 `승인` 또는 `거절`되었을 때.
  - **신규 가입 신청**: 내가 그룹장/관리자인 스터디에 새로운 `가입 신청`이 도착했을 때.
  - **새로운 공지**: 내가 속한 스터디에 새로운 `공지사항`이 등록되었을 때.
  - **새로운 채팅 메시지 (언급)**: 채팅방에서 나를 `@`멘션했을 때. (Post-MVP, MVP에서는 단순 새 메시지 알림)
  - **새로운 채팅 메시지**: 내가 현재 접속해있지 않은 채팅방에 `새로운 메시지`가 도착했을 때. (알림 중복 방지 로직 필요)

### 2.2. 알림 확인

- **US-2.1**: 사용자는 서비스 상단의 알림 아이콘을 통해 읽지 않은 알림이 있는지 여부를 확인할 수 있다. (예: 빨간 점 표시)
- **US-2.2**: 사용자가 알림 아이콘을 클릭하면, 최근 알림 목록이 드롭다운 형태로 표시된다.
  - 각 알림에는 내용과 발생 시간이 표시된다.
  - 예: "'알고리즘 정복' 스터디의 가입 신청이 승인되었습니다." (5분 전)
- **US-2.3**: 사용자는 특정 알림을 클릭하면, 해당 이벤트가 발생한 페이지로 이동할 수 있다. (예: 가입 승인 알림 클릭 시 해당 스터디 그룹 페이지로 이동)
- **US-2.4**: 사용자가 알림 목록을 열어보면, 해당 알림들은 `읽음` 상태로 처리된다.
- **US-2.5**: 사용자는 '알림 전체보기' 페이지로 이동하여 모든 알림 내역을 확인할 수 있다.

## 3. 아키텍처 및 흐름

1.  **이벤트 발생 (Next.js API Routes)**: Next.js API Routes에서 알림을 유발하는 이벤트(예: `studyService.approveJoinRequest()`)가 발생한다.
2.  **이벤트 발행 (Next.js API Routes -> Redis)**: 비즈니스 로직 처리 후, 알림에 필요한 정보를 담아 Redis의 특정 채널(예: `notifications:user:123`)에 메시지를 발행(Publish)한다.
3.  **이벤트 수신 (Signaling Server)**: Redis 채널을 구독(Subscribe)하고 있던 Node.js 시그널링 서버가 메시지를 수신한다.
4.  **실시간 푸시 (Signaling Server -> Client)**: 시그널링 서버는 수신한 메시지를 WebSocket을 통해 해당 사용자(user:123)의 클라이언트에게 `notification` 이벤트로 전송한다.
5.  **알림 표시 (Client)**: 프론트엔드 클라이언트는 `notification` 이벤트를 받아 사용자에게 실시간 알림(예: Toast UI)을 보여주고, 상단 알림 아이콘의 상태를 업데이트한다.
6.  **알림 저장 (Next.js API Routes)**: 발행된 알림 내용은 별도의 `Notification` 테이블에 저장되어, 사용자가 나중에 알림 목록을 조회할 수 있도록 한다.

## 4. API 명세 (요약)

- `GET /api/v1/notifications`: 내 알림 목록 조회
- `POST /api/v1/notifications/read`: 모든 알림을 읽음 상태로 변경
- `PATCH /api/v1/notifications/{notificationId}/read`: 특정 알림을 읽음 상태로 변경

## 5. 데이터 모델

- `Notification` 테이블
  - `id`: Int (PK)
  - `recipient`: User (FK, 알림을 받는 사람)
  - `type`: Enum (알림 종류, e.g., `STUDY_JOIN_APPROVED`, `NEW_NOTICE`)
  - `message`: String (알림 내용)
  - `link`: String (클릭 시 이동할 URL)
  - `isRead`: Boolean (읽음 여부)
  - `createdAt`: DateTime
