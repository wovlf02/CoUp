# 공지사항 상세 페이지 설계

## 📋 설계 일자
2025-11-28 (현재 날짜)

## 🎯 목적
'내 스터디'의 공지사항 탭에서 특정 공지사항을 클릭했을 때, 해당 공지사항의 전체 내용을 확인하고 관리할 수 있는 상세 페이지를 제공한다.
- 사용자 경험 극대화: 내용의 길이, 첨부 파일 유무에 관계없이 쾌적한 정보 열람 환경 제공.
- 정보 공유 및 접근성: 고유 URL을 통해 특정 공지사항 공유 및 직접 접근 용이.
- 관리 용이성: 스터디 운영자/작성자가 공지사항을 효율적으로 관리(수정/삭제)할 수 있는 기능 제공.

## 1. 개요

사용자가 '내 스터디'의 공지사항 탭에서 특정 공지사항을 클릭했을 때, 해당 공지사항의 전체 내용을 확인할 수 있는 별도의 상세 페이지를 제공한다. 이를 통해 사용자는 내용의 길이에 상관없이 쾌적한 환경에서 정보를 얻고, 필요시 페이지 링크를 다른 스터디원과 공유할 수 있다.

## 2. URL 구조

-   규칙: `/my-studies/{studyId}/announcements/{announcementId}`
-   예시: `/my-studies/123/announcements/45`

## 3. 화면 구성 요소

공지사항 상세 페이지는 사용자가 공지사항 내용을 명확하고 효율적으로 파악할 수 있도록 구성된다.

### 3.1. 네비게이션 (Breadcrumbs)
- **역할**: 사용자가 현재 위치를 직관적으로 파악하고, 상위 페이지로 쉽게 이동할 수 있도록 안내한다.
- **구성**: `내 스터디` > `{스터디 이름}` > `공지사항` > `{공지사항 제목}` 형식으로 표시한다.
    - 각 단계는 클릭 가능한 링크이며, 해당 페이지로 이동한다.
    - `{스터디 이름}`은 `studyId`에 해당하는 스터디의 실제 이름으로 동적으로 표시한다.
    - `{공지사항 제목}`은 현재 보고 있는 공지사항의 제목으로 표시하며, 링크가 아닌 현재 페이지를 나타낸다.
- **예시**: `내 스터디 > 우리 스터디 📚 > 공지사항 > 시험 일정 변경 안내`

### 3.2. 공지사항 헤더
- **역할**: 공지사항의 핵심 정보(제목, 작성자, 작성일)를 명확하게 전달한다.
- **구성 요소**:
    - **제목 (Title)**: 공지사항의 주요 내용을 나타내는 큰 제목 (H1)으로 표시한다.
    - **작성자 정보 (Author Info)**: 공지사항을 작성한 사용자의 프로필 이미지, 이름(닉네임)을 표시한다.
        - `author.name` 또는 `author.avatar` (향후 프로필 이미지 표시 시 활용)
        - `알 수 없음`과 같은 기본값 처리.
    - **작성일 (Created At)**: 공지사항이 최초로 작성된 날짜와 시간 (예: `YYYY년 MM월 DD일 HH:mm`)을 표시한다. `formatDateTimeKST` 유틸리티 함수를 활용한다.
- **예외 처리**: 작성자 정보가 유효하지 않을 경우 '알 수 없음'으로 표시.

### 3.3. 공지사항 본문 (Content)
- **역할**: 공지사항의 상세 내용을 효과적으로 전달한다.
- **표현 형식**: Markdown 문법으로 작성된 내용을 파싱하여 HTML로 렌더링한다. (예: `react-markdown` 라이브러리 활용 고려)
- **포함 가능한 요소**: 텍스트, 이미지, 동영상 링크, 코드 블록, 목록 등 다양한 미디어 및 서식.
- **가독성**: 긴 내용도 스크롤하여 편하게 읽을 수 있도록 적절한 줄 간격, 폰트 크기, 여백을 유지한다.
- **보안**: HTML 렌더링 시 XSS 공격 방지를 위한 새니타이징(sanitizing) 처리를 고려해야 한다.

### 3.4. 첨부 파일 (Attachments)
- **역할**: 공지사항과 관련된 추가 자료(문서, 이미지 등)를 제공하고 사용자가 이를 다운로드할 수 있도록 한다.
- **구성 요소**:
    - **섹션 제목**: "첨부 파일" 또는 "관련 자료" 등 명확한 제목을 표시한다.
    - **파일 목록**: 첨부된 파일 각각에 대해 다음 정보를 표시한다.
        - **파일 이름 (File Name)**: `file.name`
        - **파일 크기 (File Size)**: `formatBytes` 유틸리티 함수를 사용하여 `1.2MB`, `500KB` 등으로 변환하여 표시.
        - **다운로드 링크 (Download Link)**: `file.url`을 통해 파일을 다운로드할 수 있는 링크를 제공. (`target="_blank"`로 새 탭에서 열기)
    - **빈 상태 처리**: 첨부 파일이 없는 경우 "첨부 파일이 없습니다." 메시지를 표시한다.
- **데이터 출처**: `Notice` 모델의 `attachments` 관계를 통해 `NoticeFile`과 `File` 모델에서 데이터를 가져와 렌더링한다.

### 3.5. 액션 버튼 (Action Buttons)
- **역할**: 사용자가 페이지에서 수행할 수 있는 주요 동작(목록으로 이동, 수정, 삭제)을 제공한다.
- **구성 요소**:
    - **목록으로 (Back to List)**: 클릭 시 공지사항 목록 페이지(`/my-studies/{studyId}/notices`)로 이동한다. (`router.push` 활용)
    - **수정 (Edit)**: 현재 로그인한 사용자가 공지사항의 작성자이거나, 해당 스터디의 소유자/관리자(OWNER/ADMIN)인 경우에만 표시된다. 클릭 시 공지사항 수정 페이지로 이동한다. (URL: `/my-studies/{studyId}/announcements/{announcementId}/edit`)
    - **삭제 (Delete)**: 수정 버튼과 동일한 권한 조건으로 표시된다. 클릭 시 확인 대화 상자(confirmation dialog)를 통해 삭제 여부를 한 번 더 확인한 후 공지사항을 삭제 처리한다. (API 호출: `DELETE /api/my-studies/{studyId}/announcements/{announcementId}`)
- **권한 관리**: `session.user.id`, `notice.authorId`, `study.myRole` 등의 정보를 활용하여 조건부 렌더링을 구현한다.

### 3.5. 액션 버튼 (Action Buttons)
- **역할**: 사용자가 페이지에서 수행할 수 있는 주요 동작(목록으로 이동, 수정, 삭제)을 제공한다.
- **구성 요소**:
    - **목록으로 (Back to List)**: 클릭 시 공지사항 목록 페이지(`/my-studies/{studyId}/notices`)로 이동한다. (`router.push` 활용)
    - **수정 (Edit)**: 현재 로그인한 사용자가 공지사항의 작성자이거나, 해당 스터디의 소유자/관리자(OWNER/ADMIN)인 경우에만 표시된다. 클릭 시 공지사항 수정 페이지로 이동한다. (URL: `/my-studies/{studyId}/announcements/{announcementId}/edit`)
    - **삭제 (Delete)**: 수정 버튼과 동일한 권한 조건으로 표시된다. 클릭 시 확인 대화 상자(confirmation dialog)를 통해 삭제 여부를 한 번 더 확인한 후 공지사항을 삭제 처리한다. (API 호출: `DELETE /api/my-studies/{studyId}/announcements/{announcementId}`)
- **권한 관리**: `session.user.id`, `notice.authorId`, `study.myRole` 등의 정보를 활용하여 조건부 렌더링을 구현한다.

## 4. API 연동 및 데이터 흐름

### 4.1. 데이터 요청 (Client-side)
- `coup/src/app/my-studies/[studyId]/announcements/[announcementId]/page.jsx` 컴포넌트에서 `@tanstack/react-query`의 `useNotice` 훅을 사용하여 공지사항 상세 정보를 요청한다.
- `useNotice` 훅은 `studyId`와 `announcementId`를 인자로 받는다.
- 스터디 이름 정보를 위해 `useStudy` 훅도 함께 사용된다.

### 4.2. API 엔드포인트 (Server-side)
- 요청은 Next.js API Route `GET /api/my-studies/{studyId}/announcements/{announcementId}`로 라우팅된다.
- **파일 경로**: `coup/src/app/api/my-studies/[studyId]/announcements/[announcementId]/route.js`

### 4.3. 데이터 처리 로직 (API Route)
- `requireAuth()`를 통해 사용자 인증 및 세션 정보를 확인한다.
- `prisma.studyMember.findUnique`를 통해 요청 사용자가 해당 `studyId`의 `ACTIVE` 멤버인지 확인한다.
    - 멤버가 아닐 경우 `403 Forbidden` 응답을 반환한다.
- `prisma.notice.findUnique` 쿼리를 통해 `announcementId`와 `studyId`에 해당하는 공지사항을 조회한다.
- **Prisma `include` 옵션**:
    - `author`: 공지사항 작성자의 `id`, `name`, `avatar` 정보를 함께 가져온다.
    - `attachments`: `NoticeFile` 모델과의 관계를 `include`하여, 각 `NoticeFile` 내에 있는 실제 `File` 모델의 `file` 정보를 가져온다. (`attachments: { include: { file: true } }`)
- 공지사항이 존재하지 않을 경우 `404 Not Found` 응답을 반환한다.
- 조회된 공지사항 데이터를 `200 OK` 응답과 함께 클라이언트로 반환한다. (선택적으로 조회수 증가 로직을 포함할 수 있음)

### 4.4. 데이터 모델 (Prisma Schema)
- `Notice` 모델: `id`, `studyId`, `authorId`, `title`, `content`, `createdAt` 등의 필드와 `author` (User), `attachments` (NoticeFile[]) 관계를 포함한다.
- `NoticeFile` 모델: `id`, `noticeId`, `fileId`, `createdAt` 필드와 `notice` (Notice), `file` (File) 관계를 포함한다.
- `File` 모델: `id`, `name`, `size`, `type`, `url` 등의 필드와 `noticeFiles` (NoticeFile[]) 관계를 포함한다.

## 5. UI/UX 디자인 가이드

### 5.1. 와이어프레임 (텍스트 기반)

```
┌─────────────────────────────────────────────────────────────────┐
│ [← 내 스터디]                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 내 스터디 > {스터디 이름} > 공지사항 > {공지사항 제목}           │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📢 공지사항 제목입니다.                                     │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 작성자: [작성자 프로필 이미지] 작성자이름  |  작성일: YYYY.MM.DD HH:mm │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [공지사항 본문 내용이 여기에 표시됩니다. Markdown 렌더링]       │
│                                                                 │
│ [사진, 영상 등 다양한 미디어 첨부 가능]                         │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ <h3>첨부 파일</h3>                                         │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ 📁 [파일명.pdf] (1.2MB)  [다운로드]                           │ │
│ │ 🖼️ [이미지명.jpg] (500KB) [다운로드]                           │ │
│ │ (첨부 파일이 없는 경우: 첨부 파일이 없습니다.)              │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                         [목록으로] [수정] [삭제]                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2. 레이아웃 및 스타일
- **중앙 정렬**: 페이지 내용을 `max-width: 960px` 정도로 중앙에 배치하여 가독성을 높인다.
- **반응형 디자인**: 모바일, 태블릿, 데스크톱 등 다양한 기기에서 최적화된 레이아웃을 제공한다. (`page.module.css`의 미디어 쿼리 활용)
- **여백 및 간격**: 각 섹션과 요소 간에 충분한 여백을 두어 시각적 피로도를 줄이고 콘텐츠 집중도를 높인다.
- **폰트**: 본문은 `line-height: 1.8`을 적용하여 가독성을 확보한다. 제목, 서브 타이틀 등은 `font-weight`와 `font-size`를 조절하여 계층을 명확히 한다.
- **색상**: 프로젝트의 디자인 시스템(`var(--color-...)` 변수)을 준수하여 일관된 사용자 경험을 제공한다.
- **버튼**: '목록으로', '수정', '삭제' 버튼은 명확한 레이블과 시각적 피드백(hover, focus)을 제공한다. 특히 '삭제' 버튼은 경고 색상(`--color-danger`)을 사용한다.

## 6. 파일 구조

```
coup/src/app/my-studies/[studyId]/announcements/[announcementId]/
├── page.jsx                        # 공지사항 상세 페이지 컴포넌트
├── page.module.css                 # 페이지 전용 스타일
└── (utils/file.js)                 # formatBytes 유틸리티 함수 (공지사항 페이지 외부에도 사용될 수 있음)
```

## 7. 기술 스택

- **프레임워크**: Next.js 14 (App Router, Client Component)
- **상태 관리 및 데이터 페칭**: `@tanstack/react-query` (`useNotice` 훅)
- **데이터베이스 ORM**: Prisma
- **스타일**: CSS Modules
- **유틸리티**: `formatDateTimeKST` (`@/utils/time`), `formatBytes` (`@/utils/file`)
- **인증**: NextAuth.js (`requireAuth` 사용)

## 8. 보안 고려사항

- **접근 제어**:
    - 공지사항 상세 정보는 해당 스터디의 `ACTIVE` 멤버만 열람할 수 있도록 API 레벨에서 엄격하게 통제한다. (`requireAuth` 및 `studyMember` 확인)
    - 수정/삭제 버튼은 공지사항 작성자 또는 스터디 소유자/관리자에게만 노출 및 기능하도록 클라이언트 및 서버(API) 양쪽에서 권한 검사를 수행한다.
- **데이터 유효성 검사**: 공지사항 생성/수정 시 입력 값에 대한 서버 측 유효성 검사를 필수적으로 수행한다.
- **XSS 방지**: 공지사항 본문 내용을 HTML로 렌더링할 경우, 사용자 입력 내용에 대한 적절한 새니타이징(sanitizing) 처리를 통해 Cross-Site Scripting (XSS) 공격을 방지한다.

## 9. 구현 우선순위

- **Phase 1 (필수)**:
    - ✅ API 엔드포인트 및 Prisma 스키마 정의 (Notice, NoticeFile, File 관계)
    - ✅ 공지사항 상세 페이지 컴포넌트 (`page.jsx`) 생성 및 기본 UI 구현
    - ✅ 공지사항 목록에서 상세 페이지로 연결
    - ✅ 첨부 파일 렌더링 로직 구현
    - ✅ 브레드크럼 및 기본 정보 표시

- **Phase 2 (확장)**:
    - 공지사항 본문 Markdown 렌더링 라이브러리 (`react-markdown` 등) 적용
    - 조회수 증가 로직 (API에 선택적으로 주석 처리되어 있음)
    - 수정/삭제 버튼 및 관련 API/UI 구현
    - 첨부 파일 업로드/삭제 기능 (공지사항 생성/수정 페이지에서)

## 10. 완료 기준

- [ ] 특정 스터디의 공지사항 목록에서 특정 공지사항 클릭 시 상세 페이지로 이동
- [ ] 상세 페이지에서 공지사항 제목, 작성자, 작성일, 본문 내용이 정확히 표시됨
- [ ] 첨부된 파일 목록이 표시되며, 클릭 시 파일 다운로드가 정상적으로 작동
- [ ] 스터디 멤버가 아닐 경우 상세 페이지 접근 불가 (403 Forbidden)
- [ ] 페이지가 모바일 환경에서도 정상적으로 표시됨 (반응형 디자인)
- [ ] '목록으로' 버튼 클릭 시 공지사항 목록 페이지로 돌아감

## 11. 참고 사항

- 공지사항 본문의 이미지/영상 등 미디어 삽입 기능은 별도의 `File` 업로드 시스템과 연동될 수 있음.
- 공지사항 수정/삭제 기능은 `Notice` 모델에 대한 `PATCH` 및 `DELETE` API 라우트가 필요하며, 이는 `my-studies/[studyId]/announcements/[announcementId]/route.js`에 추가될 수 있음.
- 공지사항 생성 기능은 `my-studies/[studyId]/notices` 경로의 API (POST)를 통해 구현될 수 있음.
