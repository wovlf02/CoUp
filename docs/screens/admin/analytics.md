# 21. 관리자 - 통계 분석 (Admin Analytics)

> **화면 ID**: `ADMIN-05`  
> **라우트**: `/admin/analytics` ✅ 구현됨  
> **파일**: `app/admin/analytics/page.jsx` ✅  
> **레이아웃**: AdminLayout 사용  
> **구조**: AdminLayout + adminPageWrapper + adminMainContent + rightWidget  
> **렌더링**: CSR ('use client')  
> **권한**: SYSTEM_ADMIN (미들웨어 필요)  
> **상태관리**: useState (period)  
> **차트**: Recharts (UserGrowthChart, StudyActivityChart, EngagementChart)

---

## 📐 반응형 레이아웃 (비율 기반)

```
┌────────────┬────────────────────────────────────────────────────┬──────────────┐
│  Admin Nav │              Main Content (70%)                    │ Right Widget │
│   (12%)    │                                                    │   (18%)      │
│            │                                                    │              │
│            │  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │              │
│ 📊 대시보드 │  ┃  통계 분석          [주간▼][월간▼][연간▼]  ┃ │ 📊 요약     │
│ 👥 사용자  │  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛ │              │
│ 📚 스터디  │                                                    │ 총 사용자   │
│ ⚠️ 신고   │  ┌────────────────────────────────────────────┐    │  1,234명   │
│ 📈 통계   │  │ 📈 사용자 성장 (지난 30일)                 │    │            │
│ ⚙️ 설정   │  │                                            │    │ 총 스터디   │
│           │  │  1,400                                     │    │   156개    │
│           │  │  1,300 ●────────●                          │    │            │
│ ━━━━━━━━━ │  │  1,200     ╱      ╲                        │    │ ━━━━━━━━━ │
│           │  │  1,100    ╱        ●───●                   │    │            │
│ 🏠 메인으로│  │  1,000  ●                                  │    │ 📅 기간    │
│ 🚪 로그아웃│  │   ────────────────────────────────        │    │            │
│           │  │    11/1  11/8  11/15  11/22  11/29        │    │ 오늘       │
│  12%      │  └────────────────────────────────────────────┘    │ 어제       │
│           │                                                    │ 이번 주     │
│           │  ┌────────────────────┐ ┌────────────────────┐    │ 이번 달     │
│           │  │📊 스터디 카테고리  │ │👥 사용자 활동      │    │            │
│           │  │                    │ │                    │    │ ━━━━━━━━━ │
│           │  │  프로그래밍 ████████│ │ 활성: 1,180 (95%) │    │            │
│           │  │  취업/자격증 █████  │ │ 신규: 45 (4%)     │    │ 🔄 새로    │
│           │  │  어학 ███           │ │ 탈퇴: 12 (1%)     │    │   고침     │
│           │  │  운동/취미 ██       │ │                    │    │            │
│           │  │                    │ │ ━━━━━━━━━━━━━━  │    │ [새로고침] │
│           │  └────────────────────┘ │ 평균 체류: 23분   │    │            │
│           │                        │ 페이지뷰: 12,345  │    │ 30초마다   │
│           │  ┌────────────────────┐ │ 세션: 3,456       │    │ 자동 갱신  │
│           │  │💰 전환 퍼널        │ │                    │    │            │
│           │  │                    │ └────────────────────┘    │            │
│           │  │  방문 → 1,000      │                          │            │
│           │  │    ↓ 90%           │  ┌────────────────────┐  │            │
│           │  │  가입 → 900        │  │📈 참여도 추이      │  │            │
│           │  │    ↓ 50%           │  │                    │  │            │
│           │  │  스터디생성→450     │  │    [라인 차트]     │  │            │
│           │  │    ↓ 80%           │  │                    │  │            │
│           │  │  활성화 → 360      │  └────────────────────┘  │            │
│           │  │                    │                          │            │
│           │  └────────────────────┘                          │            │
│           │                   70%                              │    18%     │
└────────────┴────────────────────────────────────────────────────┴──────────────┘
```

---

## 🎨 섹션별 상세 설계

### 1. 기간 선택 (상단)

```
┌──────────────────────────────────────────────────────────────┐
│ [주간 ▼] [월간 ▼] [연간 ▼]    사용자 정의: [2025-11-01 ~ 11-17]│
└──────────────────────────────────────────────────────────────┘
```

**기간 옵션**:
- 오늘
- 어제
- 지난 7일
- 지난 30일
- 이번 달
- 지난 달
- 이번 년
- 사용자 정의

---

### 2. 사용자 성장 차트 (메인 상단)

```
┌────────────────────────────────────────────────────────────┐
│ 📈 사용자 성장 (지난 30일)                   [다운로드 CSV] │
│                                                            │
│  1,400 ┐                                                   │
│        │                                          ●         │
│  1,300 ┤                      ●──────●          ╱          │
│        │                     ╱         ╲        ╱           │
│  1,200 ┤            ●───────●           ●──────●            │
│        │           ╱                                        │
│  1,100 ┤      ●───●                                         │
│        │     ╱                                              │
│  1,000 ┤ ●──●                                               │
│        │                                                    │
│        └────┬────┬────┬────┬────┬────┬────┬────            │
│          11/1 11/5 11/9 11/13 11/17 11/21 11/25 11/29      │
│                                                            │
│  ━━ 총 사용자  ━━ 활성 사용자  ━━ 신규 가입                │
└────────────────────────────────────────────────────────────┘
```

**차트 기능**:
- 3가지 라인: 총 사용자, 활성 사용자, 신규 가입
- 호버 툴팁: 날짜별 상세 수치
- 범례 클릭: 라인 show/hide
- CSV 다운로드: 전체 데이터

**라이브러리**: Recharts

```jsx
<LineChart width={900} height={300} data={data}>
  <CartesianGrid strokeDasharray="3 3" />
  <XAxis dataKey="date" />
  <YAxis />
  <Tooltip />
  <Legend />
  <Line type="monotone" dataKey="total" stroke="#6366F1" name="총 사용자" />
  <Line type="monotone" dataKey="active" stroke="#10B981" name="활성 사용자" />
  <Line type="monotone" dataKey="new" stroke="#3B82F6" name="신규 가입" />
</LineChart>
```

---

### 3. 스터디 카테고리 분포 (좌측 중앙)

```
┌────────────────────────────────────┐
│ 📊 스터디 카테고리 분포            │
│                                    │
│  프로그래밍    ████████████ 45개   │
│               (38%)                │
│                                    │
│  취업/자격증   ███████ 28개        │
│               (24%)                │
│                                    │
│  어학         ████ 15개            │
│               (13%)                │
│                                    │
│  운동/취미     ███ 8개             │
│               (7%)                 │
│                                    │
│  디자인       ██ 5개               │
│               (4%)                 │
│                                    │
│  기타         ██ 5개               │
│               (4%)                 │
│                                    │
└────────────────────────────────────┘
```

**차트 타입**: 수평 바 차트

---

### 4. 사용자 활동 통계 (우측 중앙)

```
┌────────────────────────────────────┐
│ 👥 사용자 활동                     │
│                                    │
│  활성 사용자  1,180명 (95%)        │
│  ████████████████████░            │
│                                    │
│  신규 가입     45명 (4%)           │
│  ████░░░░░░░░░░░░░░░░             │
│                                    │
│  탈퇴          12명 (1%)           │
│  █░░░░░░░░░░░░░░░░░░░             │
│                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                    │
│  평균 체류 시간: 23분              │
│  총 페이지뷰: 12,345               │
│  총 세션: 3,456                    │
│  이탈률: 15%                       │
│                                    │
└────────────────────────────────────┘
```

---

### 5. 전환 퍼널 (좌측 하단)

```
┌────────────────────────────────────┐
│ 💰 전환 퍼널                       │
│                                    │
│  방문                1,000명       │
│  ███████████████████████          │
│         ↓ 90%                      │
│                                    │
│  회원가입              900명       │
│  ████████████████████             │
│         ↓ 50%                      │
│                                    │
│  스터디 생성           450명       │
│  ████████████                     │
│         ↓ 80%                      │
│                                    │
│  활성 사용자           360명       │
│  ██████████                       │
│                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                    │
│  전체 전환율: 36%                  │
│  목표 (40%) 대비: -4%              │
│                                    │
└────────────────────────────────────┘
```

**퍼널 단계**:
1. 방문 (Visit)
2. 회원가입 (Sign Up)
3. 스터디 생성 또는 가입 (Create/Join)
4. 활성 사용자 (Active - 7일 내 활동)

---

### 6. 참여도 추이 (우측 하단)

```
┌────────────────────────────────────┐
│ 📈 참여도 추이 (일간)              │
│                                    │
│  ┌──────────────────────────────┐ │
│  │                              │ │
│  │        ●──●                  │ │
│  │       ╱    ╲    ●            │ │
│  │  ●───●      ●──●  ╲          │ │
│  │                    ●──●      │ │
│  │                              │ │
│  └──────────────────────────────┘ │
│   월   화   수   목   금   토   일 │
│                                    │
│  평균 참여도: 78%                  │
│  최고: 85% (수요일)                │
│  최저: 65% (주말)                  │
│                                    │
└────────────────────────────────────┘
```

---

### 7. 우측 위젯 (18%)

**CSS (비율 기반)**:
```css
.rightWidget {
  width: 18%;
  min-width: 200px;
  max-width: 280px;
  padding: 20px;
}

@media (max-width: 1280px) {
  .rightWidget {
    width: 100%;
    max-width: 100%;
    margin-top: 20px;
  }
}
```

#### 7.1 주요 지표 요약

```
┌──────────────────┐
│ 📊 요약          │
├──────────────────┤
│                  │
│ 총 사용자         │
│  1,234명         │
│                  │
│ 총 스터디         │
│   156개          │
│                  │
│ 총 메시지         │
│  12,345개        │
│                  │
│ 총 파일          │
│   2,456개        │
│                  │
└──────────────────┘
```

---

#### 7.2 기간 선택

```
┌──────────────────┐
│ 📅 기간 선택     │
├──────────────────┤
│                  │
│ [오늘]           │
│ [어제]           │
│ [이번 주]        │
│ [이번 달]        │
│                  │
│ ━━━━━━━━━━━━━━  │
│                  │
│ 사용자 정의       │
│ [11/01 ~ 11/17]  │
│                  │
└──────────────────┘
```

---

#### 7.3 자동 갱신

```
┌──────────────────┐
│ 🔄 새로고침      │
├──────────────────┤
│                  │
│ [수동 새로고침]  │
│                  │
│ ━━━━━━━━━━━━━━  │
│                  │
│ 자동 갱신         │
│ ☑ 활성화         │
│                  │
│ 간격: 30초       │
│                  │
│ 마지막: 5초 전   │
│                  │
└──────────────────┘
```

---

## 📊 추가 차트 (스크롤)

### 8. 시간대별 활동 히트맵

```
┌────────────────────────────────────────────────────────────┐
│ 🕐 시간대별 활동 (히트맵)                                   │
│                                                            │
│      0  2  4  6  8 10 12 14 16 18 20 22                   │
│  월  █  █  █  ░  ░  ▓  ▓  █  █  █  ░  █                   │
│  화  █  █  ░  ░  ░  ▓  ▓  █  █  █  ░  █                   │
│  수  █  █  ░  ░  ░  ▓  ▓  █  █  █  █  █  ← 가장 활발      │
│  목  █  █  █  ░  ░  ▓  ▓  █  █  ▓  ░  █                   │
│  금  █  █  ░  ░  ░  ▓  ▓  █  █  ▓  ░  ░                   │
│  토  ░  ░  ░  ░  ░  ░  ▓  ▓  ▓  ░  ░  ░  ← 활동 적음      │
│  일  ░  ░  ░  ░  ░  ░  ▓  ▓  ░  ░  ░  ░                   │
│                                                            │
│  ░ 낮음  ▓ 중간  █ 높음                                    │
└────────────────────────────────────────────────────────────┘
```

**인사이트**:
- 피크 시간: 수요일 저녁 8-10시
- 저조 시간: 주말 새벽/오전

---

### 9. 디바이스 분포

```
┌────────────────────────────────────┐
│ 📱 디바이스 분포                   │
│                                    │
│  🖥️ Desktop   580명 (47%)         │
│  ████████████████                 │
│                                    │
│  📱 Mobile    540명 (44%)         │
│  ███████████████                  │
│                                    │
│  💻 Tablet    114명 (9%)          │
│  ████                             │
│                                    │
└────────────────────────────────────┘
```

---

### 10. 인기 기능 랭킹

```
┌────────────────────────────────────┐
│ ⭐ 인기 기능 (사용 빈도)           │
│                                    │
│  1. 💬 채팅         3,456회        │
│  2. 📢 공지사항     2,345회        │
│  3. 📁 파일         1,234회        │
│  4. 📅 캘린더         987회        │
│  5. ✅ 할일          876회        │
│  6. 📹 화상 통화      543회        │
│  7. ⚙️ 설정          321회        │
│                                    │
└────────────────────────────────────┘
```

---

## 📊 API 엔드포인트

```javascript
// GET /api/v1/admin/analytics?period=30d

Response:
{
  userGrowth: [
    { date: '2025-11-01', total: 1000, active: 950, new: 12 },
    // ...
  ],
  
  studyCategories: [
    { category: 'PROGRAMMING', count: 45, percentage: 38 },
    // ...
  ],
  
  userActivity: {
    active: 1180,
    activePercentage: 95,
    new: 45,
    newPercentage: 4,
    churned: 12,
    churnedPercentage: 1,
    avgSessionDuration: 23,
    totalPageViews: 12345,
    totalSessions: 3456,
    bounceRate: 15
  },
  
  conversionFunnel: [
    { stage: 'visit', count: 1000, conversionRate: 100 },
    { stage: 'signup', count: 900, conversionRate: 90 },
    { stage: 'create', count: 450, conversionRate: 50 },
    { stage: 'active', count: 360, conversionRate: 80 }
  ],
  
  engagementTrend: [
    { day: 'Mon', engagement: 75 },
    // ...
  ],
  
  deviceDistribution: [
    { device: 'desktop', count: 580, percentage: 47 },
    { device: 'mobile', count: 540, percentage: 44 },
    { device: 'tablet', count: 114, percentage: 9 }
  ],
  
  popularFeatures: [
    { feature: 'chat', count: 3456 },
    { feature: 'notices', count: 2345 },
    // ...
  ]
}
```

---

## 🎨 차트 색상 팔레트

```css
:root {
  --chart-primary: #6366F1;    /* 인디고 */
  --chart-success: #10B981;    /* 초록 */
  --chart-warning: #F59E0B;    /* 오렌지 */
  --chart-danger: #EF4444;     /* 빨강 */
  --chart-info: #3B82F6;       /* 파랑 */
  --chart-purple: #8B5CF6;     /* 보라 */
}
```

---

## 📱 반응형 설계

### Desktop
- 12% Nav + 70% Content + 18% Widget

### Tablet
- 차트 세로 배치
- 위젯 하단 이동

### Mobile
- 모든 차트 세로 스택
- 간단한 막대 차트로 전환

---

## ✅ 구현 상태 및 제한사항

### 2025-11-17 기준 - UI 90% 완료 (기능 일부 미구현)

**파일 위치**: `/admin/analytics/page.jsx` ✅  
**점검 완료**: 2025-11-17  
**상세 체크리스트**: `docs/IMPLEMENTATION_CHECKLIST.md` 참조

### 메인 콘텐츠 영역 (90% 완료)
- ✅ 페이지 헤더 "통계 분석"
- ✅ 상단 기간 선택 필터 버튼 (주간/월간/연간)
  - useState로 period 상태 관리
  - active 스타일 토글
- ✅ 사용자 성장 차트 섹션
  - UserGrowthChart 컴포넌트 (Recharts LineChart)
  - 3개 라인: total(#6366F1), active(#10B981), new(#3B82F6)
  - ⚠️ "📥 CSV 다운로드" 버튼 (UI만, 기능 미구현)
  - userGrowthData mock 데이터 (7개 데이터 포인트: 11/1~11/25)
- ✅ 2컬럼 그리드 (twoColumnGrid)
  - 좌: 스터디 카테고리 분포
    - StudyActivityChart 컴포넌트 (Recharts BarChart)
    - 6개 카테고리 (프로그래밍, 취업/자격증, 어학, 운동/취미, 디자인, 기타)
    - COLORS 배열로 색상 지정
  - 우: 사용자 활동 (chartPlaceholder 내 수동 구현)
    - 활성 사용자 95% (프로그레스 바)
    - 신규 가입 4% (프로그레스 바)
    - 탈퇴 1% (프로그레스 바)
    - ⚠️ 4개 통계 (평균 체류 시간, 페이지뷰, 세션, 이탈률) - 하드코딩
- ✅ 전환 퍼널 섹션
  - 4단계 (방문→회원가입→스터디생성→활성화)
  - conversionFunnel map 렌더링
  - 전환율 계산 및 표시
  - 전체 전환율 36%, 목표 대비 -4%
- ✅ 참여도 추이 섹션
  - EngagementChart 컴포넌트 (Recharts LineChart)
  - 일간 참여도 데이터 (월~일, 7개 데이터 포인트)
  - ⚠️ 평균/최고/최저 통계 표시 (하드코딩: "평균 78%, 최고 85%, 최저 65%")
- ✅ 2컬럼 그리드 (하단)
  - 좌: 디바이스 분포
    - Desktop/Mobile/Tablet
    - deviceDistribution map 렌더링
    - 프로그레스 바 표시
  - 우: 인기 기능 (사용 빈도)
    - popularFeatures map 렌더링
    - 순위 번호 + 기능명 + 횟수

### 우측 위젯 영역 (80% 완료)
- ✅ 📊 요약 위젯
  - ⚠️ 총 사용자: 1,234명 (하드코딩, mock 데이터 미연결)
  - ⚠️ 총 스터디: 156개 (하드코딩)
  - ⚠️ 총 메시지: 12,345개 (하드코딩)
  - ⚠️ 총 파일: 2,456개 (하드코딩)
  - 📝 개선 필요: adminStats mock 데이터와 연결 필요
- ✅ 📅 기간 선택 위젯
  - ⚠️ 4개 버튼: 오늘/어제/이번주/이번달 (UI만, 클릭 이벤트 미구현)
- ✅ 🔄 새로고침 위젯
  - ⚠️ 수동 새로고침 버튼 (UI만, 기능 미구현)
  - ⚠️ 자동 갱신 체크박스 (UI만, 기능 미구현)
  - ⚠️ "마지막: 5초 전" 텍스트 (정적)

### 차트 컴포넌트 (100% 완료)
- ✅ UserGrowthChart.jsx
  - Recharts LineChart
  - 3개 라인 (total, active, new)
  - ResponsiveContainer 사용
  - CartesianGrid, XAxis, YAxis, Tooltip, Legend 완비
- ✅ StudyActivityChart.jsx
  - Recharts BarChart
  - Cell 컴포넌트로 각 Bar 색상 지정
  - COLORS 배열: ['#6366F1', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899']
- ✅ EngagementChart.jsx
  - Recharts LineChart
  - 1개 라인 (engagement)
  - 간결한 구조

### 데이터 소스 (Mock 데이터)
- ✅ `@/mocks/admin` 에서 import
- ✅ `userGrowthData`: 7개 데이터 포인트 (11/1, 11/5, 11/9, 11/13, 11/17, 11/21, 11/25)
  - 각 항목: { date, total, active, new, churned }
- ✅ `studyActivitiesData`: 6개 카테고리
  - 각 항목: { category, count, percentage }
- ✅ `analyticsData` 객체:
  - `conversionFunnel`: 4단계 (visit, signup, create, active)
  - `engagementTrend`: 7일 (Mon~Sun)
  - `deviceDistribution`: 3개 (desktop, mobile, tablet)
  - `popularFeatures`: 7개 기능
- ⚠️ `adminStats`는 import했으나 미사용 (우측 위젯에 하드코딩)

### 스타일링 (100% 완료)
- ✅ `page.module.css` 분리 (약 400줄)
- ✅ AdminLayout 사용
- ✅ 글로벌 클래스: adminPageWrapper / adminMainContent / rightWidget
- ✅ 모듈 클래스:
  - `.analyticsPage`: 메인 컨테이너
  - `.chartSection`: 차트 섹션 공통 스타일
  - `.twoColumnGrid`: 2컬럼 그리드 (반응형)
  - `.filterButton`, `.downloadButton`, `.refreshButton`: 버튼 스타일
  - `.userActivityBar`, `.progressBarContainer`: 프로그레스 바
  - `.funnelContainer`, `.funnelStages`: 퍼널 스타일
  - `.deviceItem`, `.featureItem`: 디바이스/기능 리스트
- ✅ 반응형: `@media (max-width: 1024px)` - twoColumnGrid 세로 배치

## 📊 구현 체크리스트

### Phase 1: 기본 UI ✅ (100% 완료)
- ✅ 페이지 레이아웃 (AdminLayout)
- ✅ 헤더 및 기간 선택 버튼
- ✅ 차트 섹션 컨테이너

### Phase 2: 사용자 성장 차트 ✅ (100% 완료)
- ✅ UserGrowthChart 컴포넌트
- ✅ Recharts LineChart
- ✅ CSV 다운로드 버튼 UI

### Phase 3: 카테고리 및 활동 ✅ (100% 완료)
- ✅ StudyActivityChart (카테고리 분포)
- ✅ 사용자 활동 프로그레스 바
- ✅ 활동 통계 (체류시간/페이지뷰/세션/이탈률)

### Phase 4: 전환 퍼널 ✅ (100% 완료)
- ✅ 4단계 퍼널 렌더링
- ✅ 전환율 계산 표시
- ✅ 전체 전환율 요약

### Phase 5: 참여도 추이 ✅ (100% 완료)
- ✅ EngagementChart 컴포넌트
- ✅ 일간 참여도 라인 차트
- ✅ 평균/최고/최저 통계

### Phase 6: 디바이스 및 인기 기능 ✅ (100% 완료)
- ✅ 디바이스 분포 (Desktop/Mobile/Tablet)
- ✅ 프로그레스 바 표시
- ✅ 인기 기능 순위 (1-7위)

### Phase 7: 우측 위젯 ⚠️ (80% 완료 - UI만)
- ✅ 요약 위젯 (4개 주요 지표)
- ✅ 기간 선택 위젯
- ✅ 새로고침 위젯

### Phase 8: API 연동 및 추가 기능 ❌ (미구현)
- ❌ CSV 다운로드 기능 구현 (버튼만 존재)
- ❌ 상단 기간 선택 버튼 동작 구현 (state는 있으나 데이터 필터링 미적용)
- ❌ 우측 위젯 기간 선택 버튼 동작
- ❌ 자동 갱신 기능 구현 (체크박스만 존재)
- ❌ 수동 새로고침 기능 구현
- ❌ 우측 위젯 요약 데이터 동적 연결 (adminStats와 연결 필요)
- ❌ 시간대별 히트맵 추가 (설계만 존재, 코드 없음)
- ❌ API 연동 (현재 모든 데이터 mock)
- ❌ 실시간 데이터 업데이트
- ✅ 반응형 디자인 (twoColumnGrid만 적용, 전체 반응형은 미완성)

---

**다음 화면**: `22_admin-settings.md` (시스템 설정)
