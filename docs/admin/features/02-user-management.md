# 사용자 관리 기능 명세

> **작성일**: 2025-11-26  
> **영역**: 사용자 관리  
> **목적**: 사용자 조회, 제재, 복구 등 사용자 관리 기능

---

## 📋 목차

1. [개요](#1-개요)
2. [사용자 목록](#2-사용자-목록)
3. [사용자 상세](#3-사용자-상세)
4. [사용자 제재](#4-사용자-제재)
5. [제재 이력](#5-제재-이력)

---

## 1. 개요

### 1.1 화면 구성
```
┌─────────────────────────────────────────────────────────┐
│ 사용자 관리                [검색] [필터] [익스포트]      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 총 1,234명 | 활성: 1,100 | 정지: 3 | 탈퇴: 131         │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ID  │ 이름    │ 이메일         │ 상태  │ 가입일 │    │ │
│ ├─────────────────────────────────────────────────────┤ │
│ │ 123 │ 김철수  │ kim@ex.com    │ 활성  │ 11/01  │ 👁  │ │
│ │ 124 │ 이영희  │ lee@ex.com    │ 활성  │ 11/02  │ 👁  │ │
│ │ 125 │ 박민수  │ park@ex.com   │ 정지  │ 11/03  │ 👁  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ [1] 2 3 ... 50                           20개씩 보기 ▼ │
└─────────────────────────────────────────────────────────┘
```

### 1.2 권한
- **ADMIN**: ✅ 조회, 경고, 정지, 해제
- **SYSTEM_ADMIN**: ✅ ADMIN 권한 + 완전 삭제

---

## 2. 사용자 목록

### 2.1 검색

#### 검색 필드
```
┌─────────────────────────────────────────┐
│ 🔍 [사용자 ID, 이름, 이메일로 검색]      │
└─────────────────────────────────────────┘
```

**검색 대상**:
- 사용자 ID (정확히 일치)
- 이름 (부분 일치)
- 이메일 (부분 일치)

**검색 쿼리**:
```sql
SELECT * FROM User
WHERE 
  id = :searchId OR
  name LIKE CONCAT('%', :searchTerm, '%') OR
  email LIKE CONCAT('%', :searchTerm, '%')
```

### 2.2 필터

#### 필터 옵션
```
┌─────────────────────────────────────────┐
│ 필터                                    │
├─────────────────────────────────────────┤
│ 상태:                                   │
│ ☑ 활성  ☐ 정지  ☐ 탈퇴                  │
│                                         │
│ 역할:                                   │
│ ☑ USER  ☐ ADMIN  ☐ SYSTEM_ADMIN        │
│                                         │
│ 가입 경로:                              │
│ ☑ 이메일  ☑ Google  ☑ GitHub           │
│                                         │
│ 가입일:                                 │
│ [최근 7일 ▼]                            │
│                                         │
│ [초기화]  [적용]                        │
└─────────────────────────────────────────┘
```

**필터 쿼리**:
```sql
SELECT * FROM User
WHERE 
  status IN (:statuses) AND
  role IN (:roles) AND
  provider IN (:providers) AND
  createdAt >= :startDate AND
  createdAt <= :endDate
ORDER BY createdAt DESC
```

### 2.3 정렬

**정렬 옵션**:
- 가입일 (최신순/오래된순)
- 이름 (가나다순/역순)
- 마지막 활동 (최근/오래됨)
- 스터디 참여 수 (많은순/적은순)

### 2.4 테이블 컬럼

| 컬럼 | 표시 내용 | 너비 |
|------|-----------|------|
| ID | 사용자 ID (숫자) | 80px |
| 이름 | 사용자 이름 | 120px |
| 이메일 | 이메일 (마스킹) | 200px |
| 상태 | 배지 (활성/정지/탈퇴) | 80px |
| 역할 | USER/ADMIN/SYSTEM_ADMIN | 100px |
| 스터디 | 참여 중인 스터디 수 | 80px |
| 가입일 | YYYY-MM-DD | 100px |
| 액션 | [상세 보기] 아이콘 | 60px |

**상태 배지 색상**:
- 활성: 초록색 (#10B981)
- 정지: 빨간색 (#EF4444)
- 탈퇴: 회색 (#6B7280)

### 2.5 페이지네이션

**옵션**:
- 10개씩
- 20개씩 (기본)
- 50개씩
- 100개씩

**구현**:
```javascript
const [page, setPage] = useState(1)
const [limit, setLimit] = useState(20)

const { data, isLoading } = useQuery(
  ['users', page, limit, filters],
  () => fetchUsers({ page, limit, ...filters })
)
```

### 2.6 데이터 익스포트

**[익스포트] 버튼 클릭 시**:
```
┌─────────────────────────────────────────┐
│ 데이터 익스포트                          │
├─────────────────────────────────────────┤
│ 형식:                                   │
│ ◉ CSV  ○ Excel  ○ JSON                 │
│                                         │
│ 범위:                                   │
│ ◉ 현재 페이지 (20개)                    │
│ ○ 현재 필터 결과 (134개)                │
│ ○ 전체 (1,234개) - SYSTEM_ADMIN만      │
│                                         │
│ ⚠️ 개인정보는 자동으로 마스킹됩니다      │
│                                         │
│ [취소]  [익스포트]                      │
└─────────────────────────────────────────┘
```

**마스킹 규칙**:
- 이메일: `k***@example.com`
- 이름: `김*수` (가운데 글자)

---

## 3. 사용자 상세

### 3.1 화면 구성
```
┌─────────────────────────────────────────────────────────┐
│ ← 사용자 목록으로                    [제재] [편집]      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌──────────┐                                            │
│ │          │  김철수 (#123)                             │
│ │  [사진]  │  kim@example.com                           │
│ │          │  활성 | USER                               │
│ └──────────┘                                            │
│                                                         │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                         │
│ 📊 기본 정보                                            │
│ • 가입일: 2025-11-01 10:30                             │
│ • 가입 경로: Google                                     │
│ • 마지막 로그인: 2025-11-26 09:15                       │
│ • 마지막 활동: 2025-11-26 09:30                         │
│                                                         │
│ 📚 활동 통계                                            │
│ • 참여 스터디: 3개                                      │
│ • 작성 공지: 12개                                       │
│ • 업로드 파일: 25개                                     │
│ • 채팅 메시지: 340개                                    │
│                                                         │
│ ⚠️ 제재 이력                                            │
│ • 경고: 1회 (2025-11-15 - 욕설)                        │
│ • 정지: 0회                                             │
│                                                         │
│ 🚨 신고 이력                                            │
│ • 신고당한 횟수: 2회                                    │
│ • 신고한 횟수: 1회                                      │
│                                                         │
│ [전체 활동 로그 보기]                                   │
└─────────────────────────────────────────────────────────┘
```

### 3.2 표시 정보

#### 기본 정보
- 프로필 이미지
- 이름, 이메일
- 사용자 ID
- 상태 (활성/정지/탈퇴)
- 역할 (USER/ADMIN/SYSTEM_ADMIN)
- 가입일
- 가입 경로 (이메일/Google/GitHub)
- 마지막 로그인
- 마지막 활동

#### 활동 통계
- 참여 스터디 수 (클릭 → 스터디 목록)
- 작성 공지 수
- 업로드 파일 수
- 채팅 메시지 수
- 완료한 할일 수

#### 제재 이력
- 경고 누적 횟수 + 최근 경고 내역
- 정지 누적 횟수 + 최근 정지 내역
- 각 이력 클릭 → 상세 보기

#### 신고 이력
- 신고당한 횟수 (클릭 → 신고 목록)
- 신고한 횟수 (클릭 → 신고 목록)

### 3.3 액션 버튼

#### [제재] 버튼
- 경고 발송
- 정지 (기간 선택)
- 기능 제한
- (정지 중일 경우) 정지 해제

#### [편집] 버튼 (SYSTEM_ADMIN만)
- 역할 변경
- 이메일 변경
- 계정 완전 삭제

---

## 4. 사용자 제재

### 4.1 경고 발송

**모달**:
```
┌─────────────────────────────────────────┐
│ 사용자 경고                              │
├─────────────────────────────────────────┤
│ 대상: 김철수 (kim@example.com)          │
│                                         │
│ 경고 사유 *                             │
│ ┌─────────────────────────────────────┐ │
│ │ 채팅에서 욕설 사용                   │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│ 10/200자                                │
│                                         │
│ 관련 신고:                              │
│ [신고 #456 선택]                        │
│                                         │
│ ☑ 사용자에게 이메일 발송                 │
│                                         │
│ ⚠️ 이 사용자는 경고 1회 누적            │
│    (3회 시 자동 1일 정지)               │
│                                         │
│ [취소]  [경고 발송]                     │
└─────────────────────────────────────────┘
```

**필수 입력**:
- 경고 사유 (10-200자)

**선택 입력**:
- 관련 신고 번호
- 이메일 발송 여부

**실행**:
```sql
INSERT INTO Sanction (
  userId, type, reason, 
  relatedReportId, adminId, createdAt
) VALUES (
  :userId, 'WARNING', :reason,
  :reportId, :adminId, NOW()
)
```

**알림**:
- 인앱 알림 (필수)
- 이메일 (선택)

### 4.2 정지

**모달**:
```
┌─────────────────────────────────────────┐
│ 사용자 정지                              │
├─────────────────────────────────────────┤
│ 대상: 김철수 (kim@example.com)          │
│                                         │
│ 정지 기간 *                             │
│ ◉ 1일    ○ 3일    ○ 7일                │
│ ○ 30일   ○ 영구                         │
│                                         │
│ 정지 사유 *                             │
│ ┌─────────────────────────────────────┐ │
│ │ 반복적인 욕설 사용 및 회원 비방       │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│ 15/200자                                │
│                                         │
│ 관련 신고:                              │
│ [신고 #456, #457 선택]                  │
│                                         │
│ ☑ 사용자에게 이메일 발송                 │
│                                         │
│ ⚠️ 정지 중에는 로그인 불가               │
│                                         │
│ [취소]  [정지 실행]                     │
└─────────────────────────────────────────┘
```

**필수 입력**:
- 정지 기간
- 정지 사유 (10-200자)

**실행**:
```sql
-- User 테이블 업데이트
UPDATE User SET
  status = 'SUSPENDED',
  suspendedUntil = :suspendedUntil,
  suspendReason = :reason
WHERE id = :userId

-- Sanction 기록
INSERT INTO Sanction (
  userId, type, duration, reason,
  relatedReportId, adminId, createdAt
) VALUES (
  :userId, 'SUSPEND', :duration, :reason,
  :reportId, :adminId, NOW()
)
```

**정지 기간 계산**:
```javascript
const suspendedUntil = {
  '1일': addDays(new Date(), 1),
  '3일': addDays(new Date(), 3),
  '7일': addDays(new Date(), 7),
  '30일': addDays(new Date(), 30),
  '영구': null  // NULL = 영구
}
```

### 4.3 기능 제한

**모달**:
```
┌─────────────────────────────────────────┐
│ 기능 제한                                │
├─────────────────────────────────────────┤
│ 대상: 김철수 (kim@example.com)          │
│                                         │
│ 제한할 기능 선택 *                       │
│ ☑ 채팅 금지                             │
│ ☐ 스터디 생성 금지                       │
│ ☐ 파일 업로드 금지                       │
│ ☐ 공지 작성 금지                         │
│                                         │
│ 제한 기간 *                             │
│ ◉ 3일    ○ 7일    ○ 30일               │
│                                         │
│ 제한 사유 *                             │
│ ┌─────────────────────────────────────┐ │
│ │ 채팅에서 스팸 메시지 반복 전송        │ │
│ └─────────────────────────────────────┘ │
│ 12/200자                                │
│                                         │
│ [취소]  [제한 실행]                     │
└─────────────────────────────────────────┘
```

**실행**:
```sql
INSERT INTO FunctionRestriction (
  userId, restrictedFunctions, 
  restrictedUntil, reason, adminId
) VALUES (
  :userId, :functions,
  :until, :reason, :adminId
)
```

### 4.4 정지 해제

**모달**:
```
┌─────────────────────────────────────────┐
│ 정지 해제                                │
├─────────────────────────────────────────┤
│ 대상: 김철수 (kim@example.com)          │
│                                         │
│ 현재 정지 상태:                          │
│ • 정지일: 2025-11-25                    │
│ • 정지 사유: 욕설 사용                   │
│ • 해제 예정: 2025-11-28 (2일 남음)      │
│                                         │
│ 조기 해제 사유 *                         │
│ ┌─────────────────────────────────────┐ │
│ │ 사용자의 사과 및 재발 방지 약속      │ │
│ └─────────────────────────────────────┘ │
│ 15/200자                                │
│                                         │
│ ☑ 사용자에게 알림 발송                   │
│                                         │
│ [취소]  [정지 해제]                     │
└─────────────────────────────────────────┘
```

**실행**:
```sql
UPDATE User SET
  status = 'ACTIVE',
  suspendedUntil = NULL,
  suspendReason = NULL
WHERE id = :userId

INSERT INTO Sanction (
  userId, type, reason, adminId
) VALUES (
  :userId, 'UNSUSPEND', :reason, :adminId
)
```

---

## 5. 제재 이력

### 5.1 화면 구성
```
┌─────────────────────────────────────────────────────────┐
│ 제재 이력 (김철수)                                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 총 2건 | 경고: 1건 | 정지: 1건                          │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 2025-11-25 10:30                                    │ │
│ │ ⛔ 1일 정지 (해제됨)                                 │ │
│ │ 사유: 욕설 사용                                      │ │
│ │ 처리: admin1                                        │ │
│ │ 관련 신고: #456                                      │ │
│ │ [상세]                                              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 2025-11-15 15:20                                    │ │
│ │ ⚠️ 경고                                             │ │
│ │ 사유: 스팸 메시지 전송                               │ │
│ │ 처리: admin2                                        │ │
│ │ [상세]                                              │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 5.2 제재 유형 아이콘
- ⚠️ 경고 (WARNING)
- ⛔ 정지 (SUSPEND)
- ✅ 정지 해제 (UNSUSPEND)
- 🔒 기능 제한 (RESTRICT)

### 5.3 상세 정보
- 제재 일시
- 제재 유형
- 제재 사유
- 처리 관리자
- 관련 신고 번호
- 해제 일시 (정지인 경우)
- 해제 사유 (조기 해제인 경우)

---

## 6. 데이터 구조

### 6.1 User 테이블
```prisma
model User {
  id             String       @id @default(cuid())
  email          String       @unique
  name           String?
  avatar         String?
  role           UserRole     @default(USER)
  status         UserStatus   @default(ACTIVE)
  
  // 정지 관련
  suspendedUntil DateTime?
  suspendReason  String?
  
  // 타임스탬프
  createdAt      DateTime     @default(now())
  lastLoginAt    DateTime?
  lastActivityAt DateTime?
}

enum UserRole {
  USER
  ADMIN
  SYSTEM_ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DELETED
}
```

### 6.2 Sanction 테이블
```prisma
model Sanction {
  id              String         @id @default(cuid())
  userId          String
  type            SanctionType
  duration        String?        // '1일', '3일', etc.
  reason          String
  relatedReportId String?
  adminId         String
  
  // 정지 해제용
  unsuspendReason String?
  unsuspendAdminId String?
  unsuspendAt     DateTime?
  
  createdAt       DateTime       @default(now())
}

enum SanctionType {
  WARNING
  SUSPEND
  UNSUSPEND
  RESTRICT
}
```

---

## 7. API 연동

### 7.1 사용자 목록 조회
```
GET /api/admin/users?page=1&limit=20&status=ACTIVE
```

### 7.2 사용자 상세 조회
```
GET /api/admin/users/:userId
```

### 7.3 경고 발송
```
POST /api/admin/users/:userId/warn
Body: {
  reason: string
  relatedReportId?: string
  sendEmail: boolean
}
```

### 7.4 정지 실행
```
POST /api/admin/users/:userId/suspend
Body: {
  duration: '1일' | '3일' | '7일' | '30일' | '영구'
  reason: string
  relatedReportIds?: string[]
  sendEmail: boolean
}
```

### 7.5 정지 해제
```
POST /api/admin/users/:userId/unsuspend
Body: {
  reason: string
  sendNotification: boolean
}
```

---

## 8. 구현 체크리스트

- [ ] 사용자 목록 페이지
- [ ] 검색 및 필터
- [ ] 사용자 상세 페이지
- [ ] 경고 발송 모달
- [ ] 정지 실행 모달
- [ ] 정지 해제 모달
- [ ] 기능 제한 모달
- [ ] 제재 이력 표시
- [ ] 데이터 익스포트

---

**다음 문서**: `03-study-management.md`

