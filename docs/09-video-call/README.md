# í™”ìƒ í†µí™” ë„ë©”ì¸ (Video Call)

## ê°œìš”

CoUp í”„ë¡œì íŠ¸ì˜ í™”ìƒ í†µí™” ë„ë©”ì¸ì€ WebRTC ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ í™”ìƒ íšŒì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
ìŠ¤í„°ë”” ë©¤ë²„ë“¤ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜ìƒê³¼ ìŒì„±ìœ¼ë¡œ ì†Œí†µí•˜ê³ , í™”ë©´ ê³µìœ  ë° ì±„íŒ… ê¸°ëŠ¥ì„ í†µí•´ íš¨ê³¼ì ì¸ í˜‘ì—… í•™ìŠµì„ ì§€ì›í•©ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•

- **WebRTC P2P ì—°ê²°**: STUN ì„œë²„ë¥¼ í†µí•œ P2P ì˜ìƒ/ìŒì„± í†µì‹ 
- **í™”ë©´ ê³µìœ **: í™”ë©´ ê³µìœ ë¥¼ í†µí•œ ì‹¤ì‹œê°„ ìë£Œ ê³µìœ 
- **ì‹¤ì‹œê°„ ì±„íŒ…**: í™”ìƒ í†µí™” ì¤‘ í…ìŠ¤íŠ¸/íŒŒì¼ ì±„íŒ…
- **ë¶„ë¦¬í˜• ì•„í‚¤í…ì²˜**: ì‹œê·¸ë„ë§ ì„œë²„ ë¶„ë¦¬ë¡œ ë…ë¦½ì  í™•ì¥ ê°€ëŠ¥
- **Redis Pub/Sub**: ë‹¤ì¤‘ ì„œë²„ í™˜ê²½ ì§€ì›

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              í™”ìƒ í†µí™” ì‹œìŠ¤í…œ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         Client (Browser)                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚   VideoTile     â”‚  â”‚   ControlBar    â”‚  â”‚  SettingsModal  â”‚       â”‚ â”‚
â”‚  â”‚  â”‚   (ë¹„ë””ì˜¤ íƒ€ì¼) â”‚  â”‚   (ì»¨íŠ¸ë¡¤ ë°”)   â”‚  â”‚   (ì„¤ì • ëª¨ë‹¬)   â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚           â”‚                    â”‚                    â”‚                 â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â”‚                                â”‚                                      â”‚ â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚  â”‚                    â”‚    useVideoCall()     â”‚                          â”‚ â”‚
â”‚  â”‚                    â”‚    (WebRTC í›…)        â”‚                          â”‚ â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                        â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚           â”‚                       â”‚                       â”‚                â”‚
â”‚           â–¼                       â–¼                       â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   MediaStream   â”‚   â”‚   Socket.IO Client  â”‚   â”‚   WebRTC API    â”‚      â”‚
â”‚  â”‚  (ì¹´ë©”ë¼/ë§ˆì´í¬)â”‚   â”‚   (ì‹œê·¸ë„ë§ í†µì‹ )   â”‚   â”‚   (P2P ì—°ê²°)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                  â”‚                                         â”‚
â”‚                                  â”‚ WebSocket                               â”‚
â”‚                                  â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       Signaling Server                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚  video.js       â”‚  â”‚  chat.js        â”‚  â”‚  presence.js    â”‚       â”‚ â”‚
â”‚  â”‚  â”‚  (í™”ìƒ í•¸ë“¤ëŸ¬)  â”‚  â”‚  (ì±„íŒ… í•¸ë“¤ëŸ¬)  â”‚  â”‚  (ìƒíƒœ í•¸ë“¤ëŸ¬)  â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚           â”‚                    â”‚                    â”‚                 â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â”‚                                â”‚                                      â”‚ â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚  â”‚                    â”‚   Redis Adapter       â”‚                          â”‚ â”‚
â”‚  â”‚                    â”‚   (ë‹¤ì¤‘ ì„œë²„ ì§€ì›)    â”‚                          â”‚ â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WebRTC ì—°ê²° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client A  â”‚         â”‚ Signaling Server â”‚         â”‚   Client B  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚                          â”‚
       â”‚   1. join-room          â”‚                          â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
       â”‚                         â”‚   2. user-joined         â”‚
       â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                         â”‚                          â”‚
       â”‚   3. offer              â”‚                          â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   4. offer               â”‚
       â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                         â”‚                          â”‚
       â”‚                         â”‚   5. answer              â”‚
       â”‚   6. answer             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
       â”‚                         â”‚                          â”‚
       â”‚   7. ice-candidate      â”‚                          â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                         â”‚                          â”‚
       â”‚   8. P2P Connection Established                    â”‚
       â”‚<â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚
       â”‚                         â”‚                          â”‚
```

---

## í˜ì´ì§€ êµ¬ì¡°

```
/my-studies/[studyId]/video-call    # í™”ìƒ í†µí™” í˜ì´ì§€
â”‚
â”œâ”€â”€ page.jsx                        # ë©”ì¸ í˜ì´ì§€
â”œâ”€â”€ page.module.css                 # ìŠ¤íƒ€ì¼
â”‚
â””â”€â”€ 3ë‹¨ ë ˆì´ì•„ì›ƒ
    â”œâ”€â”€ ì°¸ì—¬ì ëª©ë¡ (ì¢Œì¸¡)
    â”‚   â””â”€â”€ ì˜¨ë¼ì¸ ì°¸ì—¬ì ë¦¬ìŠ¤íŠ¸
    â”œâ”€â”€ ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ (ì¤‘ì•™)
    â”‚   â”œâ”€â”€ VideoTile Ã— N (ì°¸ì—¬ì)
    â”‚   â””â”€â”€ ì»¨íŠ¸ë¡¤ ë°”
    â””â”€â”€ ì±„íŒ… (ìš°ì¸¡)
        â”œâ”€â”€ ë©”ì‹œì§€ ëª©ë¡
        â””â”€â”€ ë©”ì‹œì§€ ì…ë ¥
```

---

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

### 1. VideoTile (ë¹„ë””ì˜¤ íƒ€ì¼)

**íŒŒì¼ ìœ„ì¹˜:** `src/components/video-call/VideoTile.jsx`

ê°œë³„ ì°¸ì—¬ìì˜ ë¹„ë””ì˜¤ë¥¼ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```javascript
interface VideoTileProps {
  stream: MediaStream | null;     // ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼
  user: {                         // ì‚¬ìš©ì ì •ë³´
    id: string;
    name: string;
    avatar: string;
  };
  isLocal: boolean;               // ë¡œì»¬(ë³¸ì¸) ì—¬ë¶€
  isMuted: boolean;               // ìŒì†Œê±° ìƒíƒœ
  isVideoOff: boolean;            // ë¹„ë””ì˜¤ êº¼ì§ ìƒíƒœ
  isSpeaking: boolean;            // ë°œì–¸ ì¤‘ ìƒíƒœ
  isExpanded: boolean;            // í™•ëŒ€ ìƒíƒœ
  onToggleMute?: () => void;      // ìŒì†Œê±° í† ê¸€
  onToggleVideo?: () => void;     // ë¹„ë””ì˜¤ í† ê¸€
  onExpand?: () => void;          // í™•ëŒ€
  onCollapse?: () => void;        // ì¶•ì†Œ
  onDoubleClick?: () => void;     // ë”ë¸”í´ë¦­ í•¸ë“¤ëŸ¬
}
```

**ì£¼ìš” ê¸°ëŠ¥:**
- ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ í‘œì‹œ ë˜ëŠ” ì•„ë°”íƒ€ í‘œì‹œ
- ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ í‘œì‹œ
- ë°œì–¸ ì¤‘ ìƒíƒœ í‘œì‹œ (í…Œë‘ë¦¬ ì• ë‹ˆë©”ì´ì…˜)
- ì „ì²´ë³´ê¸°/ì‘ê²Œë³´ê¸° í† ê¸€
- ìŒì†Œê±°/ë¹„ë””ì˜¤ ìƒíƒœ ë°°ì§€

### 2. ControlBar (ì»¨íŠ¸ë¡¤ ë°”)

**íŒŒì¼ ìœ„ì¹˜:** `src/components/video-call/ControlBar.jsx`

í™”ìƒ í†µí™” ì»¨íŠ¸ë¡¤ ë²„íŠ¼ì„ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```javascript
interface ControlBarProps {
  isMuted: boolean;              // ìŒì†Œê±° ìƒíƒœ
  isVideoOff: boolean;           // ë¹„ë””ì˜¤ êº¼ì§ ìƒíƒœ
  isSharingScreen: boolean;      // í™”ë©´ ê³µìœ  ìƒíƒœ
  onToggleMute: () => void;      // ìŒì†Œê±° í† ê¸€
  onToggleVideo: () => void;     // ë¹„ë””ì˜¤ í† ê¸€
  onShareScreen: () => void;     // í™”ë©´ ê³µìœ 
  onLeave: () => void;           // ë‚˜ê°€ê¸°
  onSettings: () => void;        // ì„¤ì •
  callDuration?: string;         // í†µí™” ì‹œê°„
}
```

**ì»¨íŠ¸ë¡¤ ë²„íŠ¼:**

| ë²„íŠ¼ | ì•„ì´ì½˜ | ê¸°ëŠ¥ |
|------|--------|------|
| ìŒì†Œê±° | ğŸ¤ / ğŸ”‡ | ë§ˆì´í¬ on/off |
| ë¹„ë””ì˜¤ | ğŸ“¹ / ğŸ“¹âŒ | ì¹´ë©”ë¼ on/off |
| í™”ë©´ ê³µìœ  | ğŸ–¥ï¸ | í™”ë©´ ê³µìœ  ì‹œì‘/ì¤‘ì§€ |
| ì„¤ì • | âš™ï¸ | ì„¤ì • ëª¨ë‹¬ ì—´ê¸° |
| ë‚˜ê°€ê¸° | â† | í†µí™” ì¢…ë£Œ |

### 3. SettingsModal (ì„¤ì • ëª¨ë‹¬)

**íŒŒì¼ ìœ„ì¹˜:** `src/components/video-call/SettingsModal.jsx`

ë¯¸ë””ì–´ ì¥ì¹˜ ë° í’ˆì§ˆ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” ëª¨ë‹¬ì…ë‹ˆë‹¤.

```javascript
interface SettingsModalProps {
  isOpen: boolean;
  onClose: () => void;
  currentSettings: VideoCallSettings;
  onSave: (settings: VideoCallSettings) => void;
}

interface VideoCallSettings {
  audioInputDevice: string;      // ë§ˆì´í¬ ì¥ì¹˜ ID
  videoInputDevice: string;      // ì¹´ë©”ë¼ ì¥ì¹˜ ID
  audioOutputDevice: string;     // ìŠ¤í”¼ì»¤ ì¥ì¹˜ ID
  videoQuality: 'low' | 'medium' | 'high' | 'ultra';
  echoCancellation: boolean;     // ì—ì½” ì œê±°
  noiseSuppression: boolean;     // ë…¸ì´ì¦ˆ ì œê±°
  autoGainControl: boolean;      // ìë™ ê²Œì¸ ì¡°ì ˆ
}
```

**ë¹„ë””ì˜¤ í’ˆì§ˆ ì˜µì…˜:**

| í’ˆì§ˆ | í•´ìƒë„ | ì„¤ëª… |
|------|--------|------|
| `low` | 360p | ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ì ˆì•½ |
| `medium` | 480p | ë³´í†µ í’ˆì§ˆ |
| `high` | 720p | ë†’ì€ í’ˆì§ˆ (ê¸°ë³¸ê°’) |
| `ultra` | 1080p | ë§¤ìš° ë†’ì€ í’ˆì§ˆ |

---

## ì»¤ìŠ¤í…€ í›…

### useVideoCall

**íŒŒì¼ ìœ„ì¹˜:** `src/lib/hooks/useVideoCall.js`

WebRTC í™”ìƒ í†µí™”ì˜ í•µì‹¬ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” í›…ì…ë‹ˆë‹¤.

```javascript
function useVideoCall(studyId: string, roomId: string) {
  return {
    // ìƒíƒœ
    localStream: MediaStream | null;
    remoteStreams: Map<string, MediaStream>;
    participants: Participant[];
    isMuted: boolean;
    isVideoOff: boolean;
    isSharingScreen: boolean;
    someoneSharingScreen: boolean;
    speakingUsers: Set<string>;
    error: string | null;
    
    // ì•¡ì…˜
    joinRoom: (videoEnabled?: boolean, audioEnabled?: boolean) => Promise<void>;
    leaveRoom: () => void;
    toggleMute: () => boolean;
    toggleVideo: () => Promise<boolean>;
    shareScreen: () => Promise<void>;
    stopScreenShare: () => void;
  };
}
```

**ë‚´ë¶€ ë™ì‘:**

1. **ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ ì´ˆê¸°í™”**: `getUserMedia`ë¡œ ì¹´ë©”ë¼/ë§ˆì´í¬ ì ‘ê·¼
2. **Peer Connection ìƒì„±**: ê° ì°¸ì—¬ìì™€ RTCPeerConnection ìƒì„±
3. **ì‹œê·¸ë„ë§**: offer/answer/ice-candidate êµí™˜
4. **ë¯¸ë””ì–´ ì œì–´**: ìŒì†Œê±°, ë¹„ë””ì˜¤ on/off, í™”ë©´ ê³µìœ 

**ICE ì„œë²„ ì„¤ì •:**

```javascript
const iceServers = {
  iceServers: [
    { urls: 'stun:stun.l.google.com:19302' },
    { urls: 'stun:stun1.l.google.com:19302' },
    { urls: 'stun:stun2.l.google.com:19302' },
  ]
};
```

---

## ì‹œê·¸ë„ë§ ì„œë²„

### ì„œë²„ êµ¬ì¡°

**íŒŒì¼ ìœ„ì¹˜:** `signaling-server/`

```
signaling-server/
â”œâ”€â”€ server.js              # ë©”ì¸ ì„œë²„ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ video.js           # í™”ìƒ í†µí™” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
â”‚   â”œâ”€â”€ chat.js            # ì±„íŒ… ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
â”‚   â””â”€â”€ presence.js        # ìƒíƒœ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.js            # ì†Œì¼“ ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.js          # ë¡œê¹… ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ Dockerfile             # Docker ì´ë¯¸ì§€
â””â”€â”€ package.json           # ì˜ì¡´ì„±
```

### ì„œë²„ ì„¤ì • (server.js)

```javascript
// ì£¼ìš” ì„¤ì •
const io = new Server(httpServer, {
  cors: {
    origin: process.env.ALLOWED_ORIGINS?.split(','),
    credentials: true
  },
  pingTimeout: 60000,      // í•‘ íƒ€ì„ì•„ì›ƒ: 60ì´ˆ
  pingInterval: 25000,     // í•‘ ê°„ê²©: 25ì´ˆ
  maxHttpBufferSize: 1e6   // ìµœëŒ€ ë²„í¼: 1MB
});

// Redis Adapter (ë‹¤ì¤‘ ì„œë²„ ì§€ì›)
io.adapter(createAdapter(redisClient, redisSubClient));
```

### API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| GET | `/health` | í—¬ìŠ¤ ì²´í¬ |
| GET | `/metrics` | ì„œë²„ ë©”íŠ¸ë¦­ ì¡°íšŒ |

---

## Socket.IO ì´ë²¤íŠ¸

### í™”ìƒ í†µí™” ì´ë²¤íŠ¸ (video.js)

| ì´ë²¤íŠ¸ | ë°©í–¥ | í˜ì´ë¡œë“œ | ì„¤ëª… |
|--------|------|----------|------|
| `video:join-room` | â†’ Server | `{ studyId, roomId }` | ë°© ì…ì¥ |
| `video:room-state` | â† Server | `{ participants }` | í˜„ì¬ ë°© ìƒíƒœ |
| `video:user-joined` | â† Server | `{ socketId, userId, user }` | ì‹ ê·œ ì°¸ì—¬ì ì•Œë¦¼ |
| `video:offer` | â†” | `{ to, offer }` / `{ from, offer }` | WebRTC Offer |
| `video:answer` | â†” | `{ to, answer }` / `{ from, answer }` | WebRTC Answer |
| `video:ice-candidate` | â†” | `{ to, candidate }` / `{ from, candidate }` | ICE Candidate |
| `video:toggle-audio` | â†’ Server | `{ roomId, isMuted }` | ì˜¤ë””ì˜¤ ìƒíƒœ ë³€ê²½ |
| `video:toggle-video` | â†’ Server | `{ roomId, isVideoOff }` | ë¹„ë””ì˜¤ ìƒíƒœ ë³€ê²½ |
| `video:peer-audio-changed` | â† Server | `{ socketId, userId, isMuted }` | í”¼ì–´ ì˜¤ë””ì˜¤ ë³€ê²½ ì•Œë¦¼ |
| `video:peer-video-changed` | â† Server | `{ socketId, userId, isVideoOff }` | í”¼ì–´ ë¹„ë””ì˜¤ ë³€ê²½ ì•Œë¦¼ |
| `video:screen-share-start` | â†’ Server | `{ roomId }` | í™”ë©´ ê³µìœ  ì‹œì‘ |
| `video:screen-share-stop` | â†’ Server | `{ roomId }` | í™”ë©´ ê³µìœ  ì¢…ë£Œ |
| `video:peer-screen-share` | â† Server | `{ socketId, userId, isSharing }` | í™”ë©´ ê³µìœ  ì•Œë¦¼ |
| `video:leave-room` | â†’ Server | `{ roomId }` | ë°© í‡´ì¥ |
| `video:user-left` | â† Server | `{ socketId, userId }` | ì‚¬ìš©ì í‡´ì¥ ì•Œë¦¼ |

### ì±„íŒ… ì´ë²¤íŠ¸ (chat.js)

| ì´ë²¤íŠ¸ | ë°©í–¥ | í˜ì´ë¡œë“œ | ì„¤ëª… |
|--------|------|----------|------|
| `chat:send-message` | â†’ Server | `{ studyId, message, type }` | ë©”ì‹œì§€ ì „ì†¡ |
| `chat:message-received` | â† Server | `{ id, user, message, timestamp }` | ë©”ì‹œì§€ ìˆ˜ì‹  |
| `chat:video-message` | â†’ Server | `{ roomId, message }` | í™”ìƒ í†µí™” ì¤‘ ì±„íŒ… |
| `chat:video-message-received` | â† Server | `{ id, user, message, timestamp }` | í™”ìƒ í†µí™” ì±„íŒ… ìˆ˜ì‹  |
| `chat:video-file` | â†’ Server | `{ roomId, file }` | í™”ìƒ í†µí™” ì¤‘ íŒŒì¼ ì „ì†¡ |
| `chat:video-file-received` | â† Server | `{ id, user, file, timestamp }` | íŒŒì¼ ìˆ˜ì‹  |
| `chat:typing` | â†’ Server | `{ studyId, isTyping }` | íƒ€ì´í•‘ ìƒíƒœ |
| `chat:user-typing` | â† Server | `{ userId, user, isTyping }` | íƒ€ì´í•‘ ì•Œë¦¼ |

### Presence ì´ë²¤íŠ¸ (presence.js)

| ì´ë²¤íŠ¸ | ë°©í–¥ | í˜ì´ë¡œë“œ | ì„¤ëª… |
|--------|------|----------|------|
| `presence:join-study` | â†’ Server | `{ studyId }` | ìŠ¤í„°ë”” ì°¸ì—¬ |
| `presence:study-joined` | â† Server | `{ studyId, onlineCount }` | ì°¸ì—¬ ì™„ë£Œ |
| `presence:leave-study` | â†’ Server | `{ studyId }` | ìŠ¤í„°ë”” í‡´ì¥ |
| `presence:user-online` | â† Server | `{ userId, user, timestamp }` | ì˜¨ë¼ì¸ ì•Œë¦¼ |
| `presence:user-offline` | â† Server | `{ userId, user, timestamp }` | ì˜¤í”„ë¼ì¸ ì•Œë¦¼ |
| `presence:status-change` | â†’ Server | `{ status }` | ìƒíƒœ ë³€ê²½ |
| `presence:user-status-changed` | â† Server | `{ userId, user, status }` | ìƒíƒœ ë³€ê²½ ì•Œë¦¼ |

---

## ì¸ì¦ ë¯¸ë“¤ì›¨ì–´

**íŒŒì¼ ìœ„ì¹˜:** `signaling-server/middleware/auth.js`

```javascript
async function authenticateSocket(socket, next) {
  const userId = socket.handshake.auth.userId;
  const token = socket.handshake.auth.token;
  
  // Next.js APIë¡œ í† í° ê²€ì¦
  const response = await fetch(`${NEXTJS_URL}/api/auth/verify`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userId })
  });
  
  // ì¸ì¦ ì„±ê³µ ì‹œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì†Œì¼“ì— ì €ì¥
  socket.userId = data.user.id;
  socket.user = {
    id: data.user.id,
    name: data.user.name,
    email: data.user.email,
    avatar: data.user.avatar
  };
}
```

---

## ë°ì´í„° ëª¨ë¸

### ì°¸ì—¬ì ì •ë³´

```javascript
interface Participant {
  socketId: string;
  userId: string;
  user: {
    id: string;
    name: string;
    email: string;
    avatar: string | null;
  };
  isMuted: boolean;
  isVideoOff: boolean;
  isSharingScreen: boolean;
  joinedAt: Date;
}
```

### ì±„íŒ… ë©”ì‹œì§€

```javascript
interface VideoMessage {
  id: string;
  roomId: string;
  userId: string;
  user: {
    id: string;
    name: string;
    avatar: string | null;
  };
  message: string;
  type: 'text' | 'file';
  file?: {
    name: string;
    size: number;
    type: string;
    url: string;
  };
  timestamp: Date;
  socketId: string;
}
```

---

## ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ

ì°¸ì—¬ì ìˆ˜ì— ë”°ë¥¸ ìë™ ë ˆì´ì•„ì›ƒ ê³„ì‚°:

| ì°¸ì—¬ì ìˆ˜ | ë ˆì´ì•„ì›ƒ | ì„¤ëª… |
|-----------|----------|------|
| 1ëª… | 1Ã—1 | ë‹¨ì¼ ì „ì²´ í™”ë©´ |
| 2ëª… | 1Ã—2 | 2ì—´ ë°°ì¹˜ |
| 3~4ëª… | 2Ã—2 | 4ë¶„í•  |
| 5~6ëª… | 3Ã—2 | 6ë¶„í•  |
| 7~9ëª… | 3Ã—3 | 9ë¶„í•  |
| 10ëª…+ | 4Ã—N | ìŠ¤í¬ë¡¤ ê°€ëŠ¥ |

---

## í™˜ê²½ ë³€ìˆ˜

### ì‹œê·¸ë„ë§ ì„œë²„

```env
# ì„œë²„ ì„¤ì •
PORT=4000
NODE_ENV=development

# CORS ì„¤ì •
ALLOWED_ORIGINS=http://localhost:3000

# Next.js API URL (ì¸ì¦ ê²€ì¦ìš©)
NEXTJS_URL=http://localhost:3000

# Redis (ì„ íƒ - ë‹¤ì¤‘ ì„œë²„ í™˜ê²½)
REDIS_URL=redis://localhost:6379

# ë¡œê¹…
LOG_LEVEL=info
```

### Next.js í´ë¼ì´ì–¸íŠ¸

```env
# ì‹œê·¸ë„ë§ ì„œë²„ URL
NEXT_PUBLIC_SOCKET_URL=http://localhost:4000
```

---

## ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------|------|-----------|
| ì†Œì¼“ ì—°ê²° ì‹¤íŒ¨ | ì‹œê·¸ë„ë§ ì„œë²„ ë¯¸ì‹¤í–‰ | ì„œë²„ ì‹œì‘ í™•ì¸ |
| ì¹´ë©”ë¼/ë§ˆì´í¬ ê¶Œí•œ ê±°ë¶€ | ë¸Œë¼ìš°ì € ê¶Œí•œ ì„¤ì • | ê¶Œí•œ í—ˆìš© |
| ICE ì—°ê²° ì‹¤íŒ¨ | ë°©í™”ë²½, NAT ë¬¸ì œ | TURN ì„œë²„ ì¶”ê°€ |
| ë©¤ë²„ì‹­ í™•ì¸ ì‹¤íŒ¨ | ìŠ¤í„°ë”” ë¹„ë©¤ë²„ | ìŠ¤í„°ë”” ê°€ì… í•„ìš” |

---

## ë°°í¬ ì„¤ì •

### Docker (ì‹œê·¸ë„ë§ ì„œë²„)

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 4000

CMD ["node", "server.js"]
```

### Docker Compose

```yaml
services:
  signaling:
    build: ./signaling-server
    ports:
      - "4000:4000"
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
      - NEXTJS_URL=http://nextjs:3000
    depends_on:
      - redis
```

---

## ì„±ëŠ¥ ìµœì í™”

### í´ë¼ì´ì–¸íŠ¸ ì¸¡

- **ë¹„ë””ì˜¤ í’ˆì§ˆ ìë™ ì¡°ì ˆ**: ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¥¸ í’ˆì§ˆ ì¡°ì ˆ
- **Lazy ë¡œë”©**: ì›ê²© ìŠ¤íŠ¸ë¦¼ ì§€ì—° ë¡œë”©
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ìŠ¤íŠ¸ë¦¼ ì •ë¦¬

### ì„œë²„ ì¸¡

- **Redis Adapter**: ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ ê°„ ìƒíƒœ ë™ê¸°í™”
- **Room ê¸°ë°˜ ë¸Œë¡œë“œìºìŠ¤íŠ¸**: ë¶ˆí•„ìš”í•œ ë©”ì‹œì§€ ì „ì†¡ ìµœì†Œí™”
- **Graceful Shutdown**: ì•ˆì „í•œ ì„œë²„ ì¢…ë£Œ

---

## ë¸Œë¼ìš°ì € í˜¸í™˜ì„±

| ë¸Œë¼ìš°ì € | ì§€ì› | ë¹„ê³  |
|----------|------|------|
| Chrome | âœ… | ì™„ì „ ì§€ì› |
| Firefox | âœ… | ì™„ì „ ì§€ì› |
| Safari | âœ… | ì™„ì „ ì§€ì› |
| Edge | âœ… | ì™„ì „ ì§€ì› |
| IE | âŒ | ë¯¸ì§€ì› |
| ëª¨ë°”ì¼ Chrome | âœ… | ì™„ì „ ì§€ì› |
| ëª¨ë°”ì¼ Safari | âš ï¸ | ì œí•œì  ì§€ì› |

