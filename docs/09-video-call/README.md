# í™”ìƒ í†µí™” ë„ë©”ì¸

## ê°œìš”

WebRTC ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ í™”ìƒ í†µí™” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## í˜ì´ì§€ êµ¬ì¡°

```
src/app/my-studies/[studyId]/video-call/
â”œâ”€â”€ page.jsx           # í™”ìƒ í†µí™” í˜ì´ì§€
â””â”€â”€ page.module.css
```

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
src/components/video-call/
â”œâ”€â”€ ControlBar.jsx         # ì»¨íŠ¸ë¡¤ ë°”
â”œâ”€â”€ ControlBar.module.css
â”œâ”€â”€ SettingsModal.jsx      # ì„¤ì • ëª¨ë‹¬
â”œâ”€â”€ SettingsModal.module.css
â”œâ”€â”€ VideoTile.jsx          # ë¹„ë””ì˜¤ íƒ€ì¼
â””â”€â”€ VideoTile.module.css
```

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### ControlBar

í™”ìƒ í†µí™” ì»¨íŠ¸ë¡¤ ë°”ì…ë‹ˆë‹¤.

| ì†ì„± | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `isMuted` | Boolean | ìŒì†Œê±° ìƒíƒœ |
| `isVideoOff` | Boolean | ë¹„ë””ì˜¤ ë” ìƒíƒœ |
| `isSharingScreen` | Boolean | í™”ë©´ ê³µìœ  ìƒíƒœ |
| `onToggleMute` | Function | ìŒì†Œê±° í† ê¸€ |
| `onToggleVideo` | Function | ë¹„ë””ì˜¤ í† ê¸€ |
| `onShareScreen` | Function | í™”ë©´ ê³µìœ  í† ê¸€ |
| `onLeave` | Function | í†µí™” ì¢…ë£Œ |
| `onSettings` | Function | ì„¤ì • ì—´ê¸° |
| `callDuration` | String | í†µí™” ì‹œê°„ |

**ë²„íŠ¼:**
| ë²„íŠ¼ | ì•„ì´ì½˜ | ê¸°ëŠ¥ |
|------|--------|------|
| ë§ˆì´í¬ | ğŸ¤ / ğŸ”‡ | ìŒì†Œê±° í† ê¸€ |
| ë¹„ë””ì˜¤ | ğŸ“¹ / ğŸ“¹âŒ | ë¹„ë””ì˜¤ í† ê¸€ |
| í™”ë©´ ê³µìœ  | ğŸ–¥ï¸ | í™”ë©´ ê³µìœ  |
| ì„¤ì • | âš™ï¸ | ì„¤ì • ëª¨ë‹¬ |
| ë‚˜ê°€ê¸° | â† | í†µí™” ì¢…ë£Œ |

### VideoTile

ê°œë³„ ì°¸ê°€ì ë¹„ë””ì˜¤ íƒ€ì¼ì…ë‹ˆë‹¤.

| ì†ì„± | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `stream` | MediaStream | ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ |
| `user` | Object | ì‚¬ìš©ì ì •ë³´ |
| `isLocal` | Boolean | ë¡œì»¬ ì‚¬ìš©ì ì—¬ë¶€ |
| `isMuted` | Boolean | ìŒì†Œê±° ìƒíƒœ |
| `isVideoOff` | Boolean | ë¹„ë””ì˜¤ ë” ìƒíƒœ |
| `isSpeaking` | Boolean | ë°œì–¸ ì¤‘ |
| `isScreenShare` | Boolean | í™”ë©´ ê³µìœ  |

**í‘œì‹œ ì •ë³´:**
- ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼
- ì‚¬ìš©ì ì´ë¦„ ë¼ë²¨
- ìŒì†Œê±° ì•„ì´ì½˜
- ë°œì–¸ ì¤‘ í…Œë‘ë¦¬
- ë¹„ë””ì˜¤ ë” ì‹œ ì•„ë°”íƒ€

### SettingsModal

í™”ìƒ í†µí™” ì„¤ì • ëª¨ë‹¬ì…ë‹ˆë‹¤.

**ì„¤ì • í•­ëª©:**
| ì„¤ì • | ì„¤ëª… |
|------|------|
| ì¹´ë©”ë¼ | ì¹´ë©”ë¼ ì¥ì¹˜ ì„ íƒ |
| ë§ˆì´í¬ | ë§ˆì´í¬ ì¥ì¹˜ ì„ íƒ |
| ìŠ¤í”¼ì»¤ | ìŠ¤í”¼ì»¤ ì¥ì¹˜ ì„ íƒ |
| ë¹„ë””ì˜¤ í’ˆì§ˆ | 720p, 1080p ë“± |
| ë…¸ì´ì¦ˆ ìº”ìŠ¬ë§ | ë°°ê²½ ì†ŒìŒ ì œê±° |

## ì‹œê·¸ë„ë§ ì„œë²„

`signaling-server/`

WebRTC ì—°ê²°ì„ ìœ„í•œ ì‹œê·¸ë„ë§ ì„œë²„ì…ë‹ˆë‹¤.

### êµ¬ì¡°

```
signaling-server/
â”œâ”€â”€ server.js          # ë©”ì¸ ì„œë²„
â”œâ”€â”€ handlers/          # ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
â”œâ”€â”€ middleware/        # ë¯¸ë“¤ì›¨ì–´
â””â”€â”€ utils/             # ìœ í‹¸ë¦¬í‹°
```

### ì´ë²¤íŠ¸

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„:**
| ì´ë²¤íŠ¸ | ë°ì´í„° | ì„¤ëª… |
|--------|--------|------|
| `join-room` | `{ roomId, userId }` | í†µí™”ë°© ì…ì¥ |
| `leave-room` | `{ roomId }` | í†µí™”ë°© í‡´ì¥ |
| `offer` | `{ to, offer }` | SDP Offer ì „ì†¡ |
| `answer` | `{ to, answer }` | SDP Answer ì „ì†¡ |
| `ice-candidate` | `{ to, candidate }` | ICE Candidate ì „ì†¡ |

**ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸:**
| ì´ë²¤íŠ¸ | ë°ì´í„° | ì„¤ëª… |
|--------|--------|------|
| `user-joined` | `{ userId, user }` | ì‚¬ìš©ì ì…ì¥ |
| `user-left` | `{ userId }` | ì‚¬ìš©ì í‡´ì¥ |
| `offer` | `{ from, offer }` | SDP Offer ìˆ˜ì‹  |
| `answer` | `{ from, answer }` | SDP Answer ìˆ˜ì‹  |
| `ice-candidate` | `{ from, candidate }` | ICE Candidate ìˆ˜ì‹  |
| `room-users` | `[{ userId, user }]` | í˜„ì¬ ì°¸ê°€ì ëª©ë¡ |

## WebRTC ì—°ê²° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‹œê·¸ë„ë§ ì„œë²„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User A      â”‚  â”‚   User B      â”‚  â”‚   User C      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Browser â”‚  â”‚  â”‚  â”‚ Browser â”‚  â”‚  â”‚  â”‚ Browser â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚       â”‚  â”‚       â”‚       â”‚  â”‚       â”‚       â”‚
â”‚   P2P ì—°ê²°   â†â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       â”‚       â”‚  â”‚       â”‚       â”‚  â”‚       â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì—°ê²° ê³¼ì •

1. **ë°© ì…ì¥**: ì‚¬ìš©ìê°€ `join-room` ì´ë²¤íŠ¸ ì „ì†¡
2. **ê¸°ì¡´ ì°¸ê°€ì ì•Œë¦¼**: ì„œë²„ê°€ `user-joined` ë¸Œë¡œë“œìºìŠ¤íŠ¸
3. **Offer ìƒì„±**: ìƒˆ ì°¸ê°€ìê°€ ê¸°ì¡´ ì°¸ê°€ìì—ê²Œ Offer ì „ì†¡
4. **Answer ìƒì„±**: ê¸°ì¡´ ì°¸ê°€ìê°€ Answerë¡œ ì‘ë‹µ
5. **ICE Candidate êµí™˜**: ì–‘ìª½ì—ì„œ ICE Candidate êµí™˜
6. **P2P ì—°ê²° ì™„ë£Œ**: ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ì†¡ìˆ˜ì‹  ì‹œì‘

## ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼

### ë¡œì»¬ ë¯¸ë””ì–´ íšë“

```javascript
// ì¹´ë©”ë¼ ë° ë§ˆì´í¬ ì ‘ê·¼
const stream = await navigator.mediaDevices.getUserMedia({
  video: {
    width: { ideal: 1280 },
    height: { ideal: 720 }
  },
  audio: {
    echoCancellation: true,
    noiseSuppression: true
  }
})
```

### í™”ë©´ ê³µìœ 

```javascript
// í™”ë©´ ê³µìœ  ìŠ¤íŠ¸ë¦¼
const screenStream = await navigator.mediaDevices.getDisplayMedia({
  video: {
    cursor: 'always'
  },
  audio: true
})
```

## ë ˆì´ì•„ì›ƒ

### ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ

ì°¸ê°€ì ìˆ˜ì— ë”°ë¥¸ ìë™ ê·¸ë¦¬ë“œ:

| ì°¸ê°€ì ìˆ˜ | ë ˆì´ì•„ì›ƒ |
|-----------|----------|
| 1ëª… | 1x1 ì „ì²´ í™”ë©´ |
| 2ëª… | 2x1 ê°€ë¡œ ë¶„í•  |
| 3-4ëª… | 2x2 ê·¸ë¦¬ë“œ |
| 5-6ëª… | 3x2 ê·¸ë¦¬ë“œ |
| 7-9ëª… | 3x3 ê·¸ë¦¬ë“œ |

### í™”ë©´ ê³µìœ  ëª¨ë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚          í™”ë©´ ê³µìœ  (ë©”ì¸)                 â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì°¸ê°€ì1  â”‚ ì°¸ê°€ì2  â”‚ ì°¸ê°€ì3  â”‚   ...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## í†µí™” ìƒíƒœ ê´€ë¦¬

```javascript
// í†µí™” ìƒíƒœ
const [callState, setCallState] = useState({
  isConnecting: false,   // ì—°ê²° ì¤‘
  isConnected: false,    // ì—°ê²°ë¨
  isMuted: false,        // ìŒì†Œê±°
  isVideoOff: false,     // ë¹„ë””ì˜¤ ë”
  isSharingScreen: false,// í™”ë©´ ê³µìœ 
  participants: [],      // ì°¸ê°€ì ëª©ë¡
  duration: 0            // í†µí™” ì‹œê°„ (ì´ˆ)
})
```

## ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ | ì›ì¸ | ëŒ€ì‘ |
|------|------|------|
| `NotAllowedError` | ê¶Œí•œ ê±°ë¶€ | ê¶Œí•œ ìš”ì²­ ì•ˆë‚´ |
| `NotFoundError` | ì¥ì¹˜ ì—†ìŒ | ì¥ì¹˜ ì—°ê²° ì•ˆë‚´ |
| `NotReadableError` | ì¥ì¹˜ ì‚¬ìš© ì¤‘ | ë‹¤ë¥¸ ì•± ì¢…ë£Œ ì•ˆë‚´ |
| `ICE ì‹¤íŒ¨` | ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ | TURN ì„œë²„ ì‚¬ìš© |

## STUN/TURN ì„œë²„

```javascript
const iceServers = [
  { urls: 'stun:stun.l.google.com:19302' },
  { urls: 'stun:stun1.l.google.com:19302' },
  {
    urls: 'turn:turn.example.com:3478',
    username: 'user',
    credential: 'password'
  }
]
```

